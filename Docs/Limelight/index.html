

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Limelight 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/LLICO.ico"/>
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="_static/sphinx_tabs/tabs.js"></script>
        <script type="text/javascript" src="_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.2.10/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.2.10/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.2.10/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="_static/_static/css/theme.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html#document-index">
          

          
            
            <img src="_static/logo_scaled.svg" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
            
              <!-- Local TOC -->
              <div class="local-toc"><p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-getting_started">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#mounting">Mounting</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#wiring">Wiring</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#imaging">Imaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#networking-setup">Networking Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#basic-programming">Basic Programming</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-vision_pipeline_tuning">Building A Pipeline</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#input-tab">Input Tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#thresholding-tab">Thresholding Tab</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#contour-filtering">Contour Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#output">Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#d">3D</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-crosshair_calibration">Crosshair Calibration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#single-crosshair-mode">Single Crosshair Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#dual-crosshair-mode">Dual Crosshair Mode</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-using_multiple_pipelines">Using Multiple Pipelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-best_practices">Best Practices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#before-an-event">Before An Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#during-event-calibration">During Event Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#pipeline-tuning">Pipeline Tuning</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#before-connecting-to-the-field">Before Connecting to the Field</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#before-every-match">Before Every Match</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#bandwidth">Bandwidth</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-theory">Additional Theory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#vision-targets">Vision Targets</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#thresholding">Thresholding</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#contour-filtering">Contour Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#from-pixels-to-angles">From Pixels to Angles</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Programming</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-networktables_api">Complete NetworkTables API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#camera-controls">Camera Controls</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#python">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#corners">Corners</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#advanced-usage-with-raw-contours">Advanced Usage with Raw Contours</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cs_estimating_distance">Case Study: Estimating Distance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-a-fixed-angle-camera">Using a Fixed Angle Camera</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#using-area-to-estimate-distance">Using Area to Estimate Distance</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cs_aiming">Case Study: Aiming Using Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cs_seeking">Case Study: Seeking</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cs_autorange">Case Study: Getting in Range</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cs_aimandrange">Case Study: Aiming and Range at the same time.</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cs_robotexample">Case Study: 2017 Fuel Robot</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cs_drive_to_goal_2019">Case Study: DEEP SPACE 2019 Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">Python Scripting</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-python_software">Using Python to create Custom OpenCV Vision Pipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#minimal-limelight-python-script">Minimal Limelight Python Script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-python_examples">Python Examples</a></li>
</ul>
<p class="caption"><span class="caption-text">GRIP Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-grip_software">Using Grip to create Custom OpenCV Vision Pipelines</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#accessing-the-video-stream-wthin-grip">Accessing the Video Stream wthin GRIP</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-limelight-handles-inputs-to-the-pipeline">How Limelight Handles Inputs to the Pipeline</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#generating-output-for-the-limelight-to-use">Generating output for the Limelight to use</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#code-generation-for-limelight">Code Generation for Limelight</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-grip_limelight">Running GRIP Pipelines on Limelight</a></li>
</ul>
<p class="caption"><span class="caption-text">Misc</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-frequently_asked_questions">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#why-is-limelight-using-a-low-320x240-resolution">Why is limelight using a low (320x240) resolution?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#what-if-the-game-calls-for-a-different-tracking-algorithm">What if the game calls for a different tracking algorithm?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#why-is-there-an-extra-usb-port">Why is there an extra usb port?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#how-do-i-view-the-video-stream">How do I view the video stream?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#are-the-eight-leds-bright-enough">Are the eight LEDs bright enough?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#does-limelight-support-protocols-other-than-networktables">Does Limelight support protocols other than NetworkTables?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#does-limelight-support-active-poe">Does Limelight support Active PoE?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#should-i-plug-limelight-into-our-vrm-voltage-regulator-module">Should I plug Limelight into our VRM (Voltage Regulator Module)?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#my-robot-has-extreme-voltage-swings-while-driving-will-this-damage-my-limelight">My robot has extreme voltage swings while driving, will this damage my Limelight?</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#will-limelight-s-leds-dim-when-our-robot-s-voltage-drops">Will Limelight’s LEDs dim when our robot’s voltage drops?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-additional_resources">Additional Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#team-254-vision-talk">Team 254 Vision Talk</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#wpi-vision-processing-resources">WPI Vision Processing Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#grip">GRIP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-software_change_log">Software Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="index.html#id1">2022.2.3 (3/16/22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id2">2022.2.2 (2/23/22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id5">2022.1 (1/25/22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#and-2022-0-3-1-15-22">2022.0 and 2022.0.3 (1/15/22)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id8">2020.4  (3/11/20)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id9">2020.3  (2/25/20)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id10">2020.2  (1/30/20)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id13">2020.1  (1/16/20)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id16">2019.7  (4/5/19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#hotfix-3-14-19">2019.6.1 Hotfix (3/14/19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id18">2019.6 (3/12/19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id22">2019.5 (2/9/19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id24">2019.4 (1/26/19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id29">2019.3 (1/19/19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id32">2019.2 (1/7/19)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id33">2019.1 (12/18/18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id34">2019.0 (12/10/18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id35">2018.5 (3/28/18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id36">2018.4 (3/19/18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id37">2018.3 (2/28/18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id39">2018.2 (2/10/18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id42">2018.1 (1/8/18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id43">2018.0 (1/3/18)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id47">2017.7 (11/21/17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id48">2017.6 (11/13/17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id49">2017.5 (11/9/17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id50">2017.4 (10/30/17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id51">2017.3 (10/25/17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id52">2017.2 (10/23/17)</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#id53">2017.1 (10/21/17)</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html#document-index">Limelight</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html#document-index">Docs</a> &raquo;</li>
        
      <li>Limelight 1.0 documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/LimelightVision/LimelightDocs/blob/master/docs/index.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="limelight-docs">
<h1>Limelight Docs<a class="headerlink" href="#limelight-docs" title="Permalink to this headline">¶</a></h1>
<div class="figure align-center" id="id1">
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/ShimmeringHonoredEeve-size_restricted.gif"><img alt="2910" src="https://thumbs.gfycat.com/ShimmeringHonoredEeve-size_restricted.gif" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text">FRC Team 2910, Jack In The Bot (Washington, USA)</span></p>
</div>
<p>Limelight is an easy-to-use smart camera for FRC. Refer to the table of contents below to get started.</p>
<div class="toctree-wrapper compound">
<span id="document-getting_started"></span><div class="section" id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/ShabbyKaleidoscopicDassie-size_restricted.gif"><img alt="2910" src="https://thumbs.gfycat.com/ShabbyKaleidoscopicDassie-size_restricted.gif" style="width: 100%;" /></a>
<p class="caption"><span class="caption-text">FRC Team 987, HIGHROLLERS (Nevada, USA)</span></p>
</div>
<p>This page will cover the content on the official website’s “Getting Started” page.</p>
<ul class="simple">
<li><a class="reference internal" href="#mounting"><span class="std std-ref">Mounting</span></a></li>
<li><a class="reference internal" href="#wiring"><span class="std std-ref">Wiring</span></a></li>
<li><a class="reference internal" href="#imaging"><span class="std std-ref">Imaging</span></a></li>
<li><a class="reference internal" href="#networking"><span class="std std-ref">Networking Setup</span></a></li>
<li><a class="reference internal" href="#programming"><span class="std std-ref">Basic Programming</span></a></li>
</ul>
<div class="section" id="mounting">
<span id="id1"></span><h3>Mounting<a class="headerlink" href="#mounting" title="Permalink to this headline">¶</a></h3>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
Limelight 2</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
Limelight 1</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<p>Use four 1 1/2” 10-32 screws and nylock nuts to mount your Limelight.</p>
<img alt="_images/LL2DrawingSmall.png" src="_images/LL2DrawingSmall.png" />
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="upperalpha simple" start="17">
<li>What is the purpose of the status LEDs?</li>
</ol>
<p class="last">A. The green LED will blink quickly when a target has been acquired.
The yellow LED will blink if the camera is set to use a dynamic IP address, and will stay solid if the camera is using a static IP address.</p>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<p>Use four 1 1/4” 10-32 screws and nylock nuts to mount your Limelight.</p>
<img alt="_images/LL1DrawingSmall.png" src="_images/LL1DrawingSmall.png" />
</div>
</div>
</div>
<div class="section" id="wiring">
<span id="id2"></span><h3>Wiring<a class="headerlink" href="#wiring" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Limelight takes a 12V input, but is built to function down to 6V. Its LEDs have a constant brightness down to 7V.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Do not use the REV radio power module to power your Limelight</p>
</div>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-1-0 docutils container">
<div class="docutils container">
Standard Wiring</div>
</div>
<div class="item sphinx-data-tab-1-1 docutils container">
<div class="docutils container">
Power-over-Ethernet (PoE) Wiring</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-0 active docutils container">
<ul class="simple">
<li>Do not run wires to your VRM.</li>
<li>Run two wires from your limelight to a slot on your PDP (NOT your VRM).</li>
<li>Add any breaker (5A, 10A, 20A, etc.) to the same slot on your PDP.</li>
<li>Run an ethernet cable from your Limelight to your robot radio.</li>
</ul>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-1 docutils container">
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">PoE allows you to add both power and network connectivity to your Limelight via an Ethernet cable.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is not standard 44V PoE - this is why you must use a passive injector with 12V.</p>
</div>
<ul class="simple">
<li>(LIMELIGHT 1 ONLY) Ensure that your Limelight’s power jumper is set to the “E” position.</li>
<li>Connect a passive <a class="reference external" href="http://www.revrobotics.com/rev-11-1210/">Passive PoE Injector</a> to your PDP (NOT your VRM).</li>
<li>Add any breaker (5A, 10A, 20A, etc.) to the same slot on your PDP.</li>
<li>Run an ethernet cable from your Limelight to your passive POE injector.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="imaging">
<span id="id3"></span><h3>Imaging<a class="headerlink" href="#imaging" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Limelight will receive software updates for improvements and features to accomodate the game if necessary.</p>
</div>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-2-0 docutils container">
<div class="docutils container">
Limelight 2</div>
</div>
<div class="item sphinx-data-tab-2-1 docutils container">
<div class="docutils container">
Limelight 1</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-2-0 active docutils container">
<ul class="simple">
<li>Do not use a Windows 7 or Windows XP machine.</li>
<li>Remove power from your limelight.</li>
<li>Download the latest drivers, flasher tool, and image from from the <a class="reference external" href="https://limelightvision.io/pages/downloads">Downloads</a> Page.</li>
<li>Install the latest Balena Etcher flash tool from the <a class="reference external" href="https://limelightvision.io/pages/downloads">Downloads</a> Page. The “installer” version is recommended.</li>
<li>Run a USB-MicroUSB cable from your laptop to your limelight.</li>
<li>Run “Balena Etcher” as an administrator.</li>
<li>It may take up to 20 seconds for your machine to recognize the camera.</li>
<li>Select the latest .zip image in your downloads folder</li>
<li>Select a “Compute Module” device in the “Drives” menu</li>
<li>Click “Flash”</li>
<li>Once flashing is complete, remove the usb cable from your limelight.</li>
</ul>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-2-1 docutils container">
<a class="reference internal image-reference" href="_images/esd-susceptibility-symbol.gif"><img alt="_images/esd-susceptibility-symbol.gif" class="align-center" src="_images/esd-susceptibility-symbol.gif" style="width: 64px; height: 64px;" /></a>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Some versions of Limelight 1 are electrostatically sensitive around the micro-usb port.  To prevent damaging the port, ground yourself to something metal before you connect to the micro usb port.  This will ensure your personal static charge has been discharged.</p>
</div>
<ul class="simple">
<li>Do not use a Windows 7 or Windows XP machine.</li>
<li>Remove power from your limelight.</li>
<li>Download the latest drivers, flasher tool, and image from from the <a class="reference external" href="https://limelightvision.io/pages/downloads">Downloads</a> Page.</li>
<li>Install the latest Balena Etcher flash tool from the <a class="reference external" href="https://limelightvision.io/pages/downloads">Downloads</a> Page. The “installer” version is recommended.</li>
<li>Run a USB-MicroUSB cable from your laptop to your limelight.</li>
<li>Apply power to your limelight.</li>
<li>Run “Balena Etcher” as an administrator.</li>
<li>It may take up to 20 seconds for your machine to recognize the camera.</li>
<li>Select the latest .zip image in your downloads folder</li>
<li>Select a “Compute Module” device in the “Drives” menu</li>
<li>Click “Flash”</li>
<li>Once flashing is complete, remove power from your limelight</li>
</ul>
</div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Only connect the microUSB cable while imaging. Limelight enters a special flash mode while the microUSB cable is connected. You will not be able to access the web interface while Limelight is in flash mode.</p>
</div>
</div>
<div class="section" id="networking-setup">
<span id="networking"></span><h3>Networking Setup<a class="headerlink" href="#networking-setup" title="Permalink to this headline">¶</a></h3>
<p>We highly reccomend following the static IP instructions for reliability during events.</p>
<p>Follow these steps before starting:</p>
<ul class="simple">
<li>Go to add/remove programs in windows, and search for “bonjour”</li>
<li><dl class="first docutils">
<dt>How many items do you see?</dt>
<dd><ul class="first last">
<li>If there are two (2) items with “bonjour” in their names, uninstall “bonjour print services”</li>
<li>If there are no (0) items with “bonjour” in their names, install bonjour from our <a class="reference external" href="https://limelightvision.io/pages/downloads">Downloads</a> page.</li>
</ul>
</dd>
</dl>
</li>
<li>Reboot your robot and computer.</li>
<li>Download the  <a class="reference external" href="https://limelightvision.io/pages/downloads/">Limelight Finder Tool</a></li>
<li>Follow the steps listed below.</li>
</ul>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-3-0 docutils container">
<div class="docutils container">
Static IP Address (Recommended)</div>
</div>
<div class="item sphinx-data-tab-3-1 docutils container">
<div class="docutils container">
Dynamic IP Address (Not recommended)</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-3-0 active docutils container">
<ul class="simple">
<li>Follow the bonjour-related instructions above.</li>
<li>Power-up your robot, and connect your laptop to your robot’s network.</li>
<li>After your Limelight flashes its LED array, open the Limelight Finder Tool and search for your Limelight or navigate to <a class="reference external" href="http://limelight.local:5801">http://limelight.local:5801</a>. This is the configuration panel.</li>
<li>Navigate to the “Settings” tab on the left side of the interface.</li>
<li>Enter your team number and press the “Update Team Number” button.</li>
<li>Change your “IP Assignment” to “Static”.</li>
<li>Set your Limelight’s IP address to “10.TE.AM.11”.</li>
<li>Set the Netmask to “255.255.255.0”.</li>
<li>Set the Gateway to “10.TE.AM.1”.</li>
<li>Click the “Update” button.</li>
<li>Give your roboRIO the following static IP address: “10.TE.AM.2”</li>
<li>Power-cycle your robot.</li>
<li>You will now be access your config panel at <a class="reference external" href="http://10.TE.AM.11:5801">http://10.TE.AM.11:5801</a>, and your camera stream at <a class="reference external" href="http://10.TE.AM.11:5800">http://10.TE.AM.11:5800</a></li>
</ul>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-3-1 docutils container">
<ul class="simple">
<li>Follow the bonjour-related instructions above.</li>
<li>Power-up your robot, and connect your laptop to your robot’s network.</li>
<li>After your Limelight flashes its LED array, open the Limelight Finder Tool and search for your Limelight or navigate to <a class="reference external" href="http://limelight.local:5801">http://limelight.local:5801</a>. This is the configuration panel.</li>
<li>Navigate to the “Settings” tab on the left side of the interface.</li>
<li>Enter your team number and press the “Update Team Number” button.</li>
<li>Change your “IP Assignment” to “Automatic”.</li>
<li>Click the “Update” button.</li>
<li>Power-cycle your robot.</li>
<li>You can continue be access your config panel at <a class="reference external" href="http://limelight.local:5801">http://limelight.local:5801</a>, and your camera stream at <a class="reference external" href="http://limelight.local:5800">http://limelight.local:5800</a></li>
</ul>
</div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="upperalpha simple" start="17">
<li>Why do we reccommend a static IP?</li>
</ol>
<ol class="upperalpha simple">
<li>First, it shaves multiple seconds off Limelight’s boot time. Second, teams have historically had issues with DHCP assignment and mDNS responders on actual FRC fields and with event radio firmware.</li>
</ol>
<p class="last">We recommend setting static IP addresses on your robo-rio and driverstation as well.  The networking settings to use
on all of these devices can be found near the bottom half of this web page:
<a class="reference external" href="https://docs.wpilib.org/en/stable/docs/networking/networking-introduction/ip-configurations.html">https://docs.wpilib.org/en/stable/docs/networking/networking-introduction/ip-configurations.html</a></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ol class="upperalpha simple" start="17">
<li>How do I reset the IP address?</li>
</ol>
<ol class="upperalpha simple">
<li>After your Limelight has booted, hold the config button on the front face of the camera until the LEDs start blinking. Power-cycle your robot, and your Limelight will have an automatically-assigned IP address.</li>
</ol>
<a class="last reference internal image-reference" href="_images/limelight_reset.png"><img alt="_images/limelight_reset.png" class="align-center" src="_images/limelight_reset.png" style="height: 180px;" /></a>
</div>
<ul class="simple">
<li>If the above steps do not fix the problem, install Angry IP scanner and find the address for your limelight.</li>
<li>Go to &lt;limelightaddress&gt;:5801, and give your limelight a .11 static IP.</li>
<li>From this point onward, you can rely on the static IP to access the page.</li>
</ul>
</div>
<div class="section" id="basic-programming">
<span id="programming"></span><h3>Basic Programming<a class="headerlink" href="#basic-programming" title="Permalink to this headline">¶</a></h3>
<p>For now, we just need to get data from the camera to your robot. Limelight posts targeting data to Network Tables at 100hz. The default update rate for NetworkTables is 10hz, but Limelight automatically overwrites it to allow for more frequent data transfer.</p>
<p>To get started, we recommend reading four values from the “limelight” Network Table as frequently as possible. Our code samples will show you exactly how to do this. The offsets to your target (in degrees) are sent as “tx” and “ty”. These can be used to turn your robot, turn a turret, etc. The target’s area, sent as “ta”, may be used a rough indicator of distance to your target. Area is a value between 0 and 100, where 0 means that your target’s hull area is 0% of the total image area, and 100 means that your target’s hull fills the entire image. The rotation or “skew” of your target is returned as “ts”. If all values are equal to zero, no targets exist.</p>
<p>In addition, you may control certain features by setting values in NetworkTables. See the complete NT API here: <a class="reference internal" href="index.html#document-networktables_api"><span class="doc">Complete NetworkTables API</span></a></p>
<p>Read the following from the “limelight” table</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>tv</td>
<td>Whether the limelight has any valid targets (0 or 1)</td>
</tr>
<tr class="row-even"><td>tx</td>
<td>Horizontal Offset From Crosshair To Target (-27 degrees to 27 degrees)</td>
</tr>
<tr class="row-odd"><td>ty</td>
<td>Vertical Offset From Crosshair To Target (-20.5 degrees to 20.5 degrees)</td>
</tr>
<tr class="row-even"><td>ta</td>
<td>Target Area (0% of image to 100% of image)</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p>Write the following to the “limelight” table</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ledMode</td>
<td>Sets limelight’s LED state</td>
</tr>
<tr class="row-even"><td>0</td>
<td>use the LED Mode set in the current pipeline</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>force off</td>
</tr>
<tr class="row-even"><td>2</td>
<td>force blink</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>force on</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>camMode</td>
<td>Sets limelight’s operation mode</td>
</tr>
<tr class="row-even"><td>0</td>
<td>Vision processor</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>Driver Camera (Increases exposure, disables vision processing)</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>pipeline</td>
<td>Sets limelight’s current pipeline</td>
</tr>
<tr class="row-even"><td>0 .. 9</td>
<td>Select pipeline 0..9</td>
</tr>
</tbody>
</table>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-4-0 docutils container">
<div class="docutils container">
Java</div>
</div>
<div class="item sphinx-data-tab-4-1 docutils container">
<div class="docutils container">
LabView</div>
</div>
<div class="item sphinx-data-tab-4-2 docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-4-3 docutils container">
<div class="docutils container">
Python</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-4-0 active docutils container">
<p>Don’t forget to add these imports:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.smartdashboard.SmartDashboard</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.networktables.NetworkTable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.networktables.NetworkTableEntry</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.networktables.NetworkTableInstance</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">NetworkTable</span> <span class="n">table</span> <span class="o">=</span> <span class="n">NetworkTableInstance</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">getTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
<span class="n">NetworkTableEntry</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;tx&quot;</span><span class="p">);</span>
<span class="n">NetworkTableEntry</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;ty&quot;</span><span class="p">);</span>
<span class="n">NetworkTableEntry</span> <span class="n">ta</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;ta&quot;</span><span class="p">);</span>

<span class="c1">//read values periodically</span>
<span class="kt">double</span> <span class="n">x</span> <span class="o">=</span> <span class="n">tx</span><span class="p">.</span><span class="na">getDouble</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">y</span> <span class="o">=</span> <span class="n">ty</span><span class="p">.</span><span class="na">getDouble</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">area</span> <span class="o">=</span> <span class="n">ta</span><span class="p">.</span><span class="na">getDouble</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span>

<span class="c1">//post to smart dashboard periodically</span>
<span class="n">SmartDashboard</span><span class="p">.</span><span class="na">putNumber</span><span class="p">(</span><span class="s">&quot;LimelightX&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
<span class="n">SmartDashboard</span><span class="p">.</span><span class="na">putNumber</span><span class="p">(</span><span class="s">&quot;LimelightY&quot;</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
<span class="n">SmartDashboard</span><span class="p">.</span><span class="na">putNumber</span><span class="p">(</span><span class="s">&quot;LimelightArea&quot;</span><span class="p">,</span> <span class="n">area</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-4-1 docutils container">
<img alt="_images/Labview_10.png" src="_images/Labview_10.png" />
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-4-2 docutils container">
<p>Don’t forget to add these #include directives:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;frc/smartdashboard/Smartdashboard.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;networktables/NetworkTable.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;networktables/NetworkTableInstance.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;networktables/NetworkTableEntry.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;networktables/NetworkTableValue.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;wpi/span.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NetworkTable</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">nt</span><span class="o">::</span><span class="n">NetworkTableInstance</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">targetOffsetAngle_Horizontal</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;tx&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">targetOffsetAngle_Vertical</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ty&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">targetArea</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ta&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">targetSkew</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ts&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-4-3 docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">networktables</span> <span class="kn">import</span> <span class="n">NetworkTables</span>

<span class="n">table</span> <span class="o">=</span> <span class="n">NetworkTables</span><span class="o">.</span><span class="n">getTable</span><span class="p">(</span><span class="s2">&quot;limelight&quot;</span><span class="p">)</span>
<span class="n">tx</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ty</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s1">&#39;ty&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ta</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s1">&#39;ta&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s1">&#39;ts&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<span id="document-vision_pipeline_tuning"></span><div class="section" id="building-a-pipeline">
<h2>Building A Pipeline<a class="headerlink" href="#building-a-pipeline" title="Permalink to this headline">¶</a></h2>
<p>To configure a limelight vision pipeline, first access its web interface at <a class="reference external" href="http://10.te.am.11:5801">http://10.te.am.11:5801</a>. If you have opted to use a dynamically assigned ip-address, access the interface at <a class="reference external" href="http://limelight.local:5801">http://limelight.local:5801</a>.</p>
<p>The “Tracking” page is comprised of five tuning tabs:</p>
<ul class="simple">
<li><a class="reference internal" href="#input"><span class="std std-ref">Input Tab</span></a></li>
<li><a class="reference internal" href="#thresholding"><span class="std std-ref">Thresholding Tab</span></a></li>
<li><a class="reference internal" href="#contour-filtering"><span class="std std-ref">Contour Filtering</span></a></li>
<li><a class="reference internal" href="#output"><span class="std std-ref">Output</span></a></li>
<li><a class="reference internal" href="#d"><span class="std std-ref">3D</span></a></li>
</ul>
<hr class="docutils" />
<div class="section" id="input-tab">
<span id="input"></span><h3>Input Tab<a class="headerlink" href="#input-tab" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>The Input Tab hosts controls to change the raw camera image before it is passed through the processing pipeline.</p>
<div class="section" id="pipeline-type">
<h4>Pipeline Type<a class="headerlink" href="#pipeline-type" title="Permalink to this headline">¶</a></h4>
<p>Controls the desired pipeline type. Change this option to utilize GRIP or Python Pipelines.</p>
</div>
<div class="section" id="source-image">
<h4>Source Image<a class="headerlink" href="#source-image" title="Permalink to this headline">¶</a></h4>
<p>Controls the source of the image that is passed through the pipeline. Switch to “Snapshot” to test your vision pipelines on stored Snapshots.</p>
<p>This control auto-resets to “Camera” when the GUI is closed.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/MintyKaleidoscopicHarpseal-size_restricted.gif"><img alt="https://thumbs.gfycat.com/MintyKaleidoscopicHarpseal-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/MintyKaleidoscopicHarpseal-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="resolution-zoom">
<h4>Resolution + Zoom<a class="headerlink" href="#resolution-zoom" title="Permalink to this headline">¶</a></h4>
<p>Controls the resolution of the camera and vision pipeline. We recommend using the 320x240 pipeline unless you are utilizing 3D functionality.</p>
<p>320x240 pipelines execute at 90fps, while 960x720 pipelines execute at 22 fps.
In 2020, 2x and 3x Hardware Zoom options were added to this field. The zoom options are not digital and use 100% real sensor pixels.</p>
<img alt="https://thumbs.gfycat.com/LawfulRapidArchaeocete-size_restricted.gif" src="https://thumbs.gfycat.com/LawfulRapidArchaeocete-size_restricted.gif" />
</div>
<div class="section" id="leds">
<h4>LEDs<a class="headerlink" href="#leds" title="Permalink to this headline">¶</a></h4>
<p>Controls the default LED mode for this pipeline. This may be overidden during a match with the “LED” network table option.</p>
<p>Limelight 2+ users have access to an “LED Brightness” Slider which allows for LED dimming.</p>
</div>
<div class="section" id="orientation">
<h4>Orientation<a class="headerlink" href="#orientation" title="Permalink to this headline">¶</a></h4>
<p>Controls the orientation of incoming frames. Set it to “inverted” if your camera is mounted upside-down.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/ImpeccableWhichCaracal-size_restricted.gif"><img alt="https://thumbs.gfycat.com/ImpeccableWhichCaracal-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/ImpeccableWhichCaracal-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="exposure">
<h4>Exposure<a class="headerlink" href="#exposure" title="Permalink to this headline">¶</a></h4>
<p>Controls the camera’s exposure setting in .1 millisecond intervals. Think of a camera as a grid of light-collecting buckets - exposure time controls how long your camera’s “buckets” are open per frame. Lowering the exposure time will effectively darken your image. Low and fixed exposure times are crucial in FRC, as they black-out the bulk of incoming image data. Well-lit retroreflective tape will stand out in a mostly black image, turning vision processing into a straightforward process.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/IlliterateRemoteIberianmole-size_restricted.gif"><img alt="https://thumbs.gfycat.com/IlliterateRemoteIberianmole-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/IlliterateRemoteIberianmole-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="black-level-offset">
<h4>Black Level Offset<a class="headerlink" href="#black-level-offset" title="Permalink to this headline">¶</a></h4>
<p>Increasing the black level offset can significantly darken your camera stream. This should be increased to further remove arena lights and bright spots from your image. This is a sensor-level setting, and not a fake digital brightness setting.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/SeparateFatHedgehog-size_restricted.gif"><img alt="https://thumbs.gfycat.com/SeparateFatHedgehog-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/SeparateFatHedgehog-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="red-balance-blue-balance">
<h4>Red Balance, Blue Balance<a class="headerlink" href="#red-balance-blue-balance" title="Permalink to this headline">¶</a></h4>
<p>Controls the intensity of Red and Blue color components in your image. These collecively control your Limelight’s white balance. We recommend leaving these at their default values of</p>
<hr class="docutils" />
</div>
</div>
<div class="section" id="thresholding-tab">
<span id="thresholding"></span><h3>Thresholding Tab<a class="headerlink" href="#thresholding-tab" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>Thresholding is a critical component of most FRC vision tracking algorithms. It is the act of taking an image, and throwing away any pixels that aren’t in a specific color range. The result of thresholding is generally a one-dimensional image in which a pixel is either “on” or “off.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/MisguidedClumsyCusimanse-size_restricted.gif"><img alt="https://thumbs.gfycat.com/MisguidedClumsyCusimanse-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/MisguidedClumsyCusimanse-size_restricted.gif" style="width: 100%;" /></a>
<div class="section" id="video-feed-located-beneath-stream">
<h4>Video Feed (Located beneath stream)<a class="headerlink" href="#video-feed-located-beneath-stream" title="Permalink to this headline">¶</a></h4>
<p>Controls which image is streamed from the mjpeg server. You should switch to the “threshold” image if you need to tune your HSV thresholding.</p>
</div>
<div class="section" id="thresholding-wands">
<h4>Thresholding Wands<a class="headerlink" href="#thresholding-wands" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Wands enable users to click on Limelights’s video stream to perform automatic HSV thresholding.</dt>
<dd><ul class="first last simple">
<li>The “Eyedropper” wand centers HSV parameters around the selected pixel</li>
<li>The “Add” wand adjusts HSV parameters to include the selected pixel</li>
<li>The “Subtract” wand adjust HSV paramters to ignore the selected pixel</li>
</ul>
</dd>
</dl>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/AdorableScientificLaughingthrush-size_restricted.gif"><img alt="https://thumbs.gfycat.com/AdorableScientificLaughingthrush-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/AdorableScientificLaughingthrush-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="hue">
<h4>Hue<a class="headerlink" href="#hue" title="Permalink to this headline">¶</a></h4>
<p>Describes a “pure” color. A Hue of “0” describes pure red, and a hue of 1/3 (59 on the slider) describes pure green. Hue is useful because it doesn’t change as a pixel “brightens” or “darkens”. This is the most important parameter to tune. If you make your hue range as small as possible, you will have little if any trouble transitioning to an actual FRC field.</p>
<img alt="_images/huebar.png" class="align-center" src="_images/huebar.png" />
</div>
<div class="section" id="saturation">
<h4>Saturation<a class="headerlink" href="#saturation" title="Permalink to this headline">¶</a></h4>
<p>Describes the extent to which a color is “pure”. Another way to think of this is how washed-out a color appears, that is, how much “white” is in a color. Low saturation means a color is almost white, and high saturation means a color is almost “pure”.</p>
</div>
<div class="section" id="value">
<h4>Value<a class="headerlink" href="#value" title="Permalink to this headline">¶</a></h4>
<p>Describes the darkness of a color, or how much “black” is in a color. A low value corresponds to a near-black color. You should absolutely increase the minimum value from zero, so that black pixels are not passed through the processing pipeline.</p>
</div>
<div class="section" id="erosion-and-dilation">
<h4>Erosion and Dilation<a class="headerlink" href="#erosion-and-dilation" title="Permalink to this headline">¶</a></h4>
<p>Erosion slightly erodes the result of an HSV threshold. This is useful if many objects are passing through a tuned HSV threshold.
Dilation slightly inflates the result of an HSV threshold. Use this to patch holes in thresholding results.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/PastBouncyGnat-size_restricted.gif"><img alt="https://thumbs.gfycat.com/PastBouncyGnat-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/PastBouncyGnat-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="hue-inversion">
<h4>Hue Inversion<a class="headerlink" href="#hue-inversion" title="Permalink to this headline">¶</a></h4>
<p>Use hue inversion to track red targets, as red exists at both the beginning and the end of the hue range.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/MeekSnarlingFluke-size_restricted.gif"><img alt="https://thumbs.gfycat.com/MeekSnarlingFluke-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/MeekSnarlingFluke-size_restricted.gif" style="width: 100%;" /></a>
<hr class="docutils" />
</div>
</div>
<div class="section" id="contour-filtering">
<span id="id1"></span><h3>Contour Filtering<a class="headerlink" href="#contour-filtering" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>After thresholding, Limelight generates a list of contours. After that, each contour is wrapped in a bounding rectangle an unrotated rectangle, and a “convex hull”.
These are passed through a series of filters to determine the “best” contour. If multiple contours pass through all filters, Limelight chooses the best contour using the “Sort Mode” Control.</p>
<div class="section" id="sort-mode">
<h4>Sort Mode<a class="headerlink" href="#sort-mode" title="Permalink to this headline">¶</a></h4>
<p>Controls how contours are sorted after they are passed through all other filters.</p>
<p>In 2019, the “closest” sort mode was added. This mode will select the target that is closest to the configurable crosshair.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/EnormousImpishDeer-size_restricted.gif"><img alt="https://thumbs.gfycat.com/EnormousImpishDeer-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/EnormousImpishDeer-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="target-area">
<h4>Target Area<a class="headerlink" href="#target-area" title="Permalink to this headline">¶</a></h4>
<p>Controls the range of acceptable bounding-rectangle areas, as percentages of the screen. You can increase the minimum area to help filter-out stadium lights, and decrease the maximum value to help filter-out things like large displays near the field.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/HairyWarlikeCusimanse-size_restricted.gif"><img alt="https://thumbs.gfycat.com/HairyWarlikeCusimanse-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/HairyWarlikeCusimanse-size_restricted.gif" style="width: 100%;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The area slider is not linearly scaled, but quarticly scaled. This is done to provide extra precision near the lower-end of area values, where many FRC targets lie. The area of a square scales quadratically with its side length, but x^4 scaling provides even greater precision where it is needed.</p>
</div>
</div>
<div class="section" id="target-fullness">
<h4>Target Fullness<a class="headerlink" href="#target-fullness" title="Permalink to this headline">¶</a></h4>
<p>Fullness is the percentage of “on” pixels in the chosen contour’s bounding rectangle. A solid rectangle target will have a near-1.0 fullness, while a U-shaped target will have a low fullness.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/AmazingUnfortunateFlyingfish-size_restricted.gif"><img alt="https://thumbs.gfycat.com/AmazingUnfortunateFlyingfish-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/AmazingUnfortunateFlyingfish-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="target-aspect-ratio">
<h4>Target Aspect Ratio<a class="headerlink" href="#target-aspect-ratio" title="Permalink to this headline">¶</a></h4>
<p>Aspect ratio is defined by the width of the bounding rectangle of the chosen contour divided by its height. A low aspect ratio describes a “tall” rectangle, while a high aspect ratio describes a “wide” rectangle.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/BlankMatureAzurevase-size_restricted.gif"><img alt="https://thumbs.gfycat.com/BlankMatureAzurevase-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/BlankMatureAzurevase-size_restricted.gif" style="width: 100%;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The aspect ratio slider is also quadratically scaled.</p>
</div>
</div>
<div class="section" id="direction-filter">
<h4>Direction Filter<a class="headerlink" href="#direction-filter" title="Permalink to this headline">¶</a></h4>
<p>Rejects contours on the basis of their orientation.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/SparklingConcernedCockatoo-size_restricted.gif"><img alt="https://thumbs.gfycat.com/SparklingConcernedCockatoo-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/SparklingConcernedCockatoo-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="smart-speckle-rejection">
<h4>Smart Speckle Rejection<a class="headerlink" href="#smart-speckle-rejection" title="Permalink to this headline">¶</a></h4>
<p>Rejects relatively small (as opposed to absolutely small w/ the area filter) contours that have passed through all other filters. This is essential if a target must remain trackable from short-range and long-range.
This feature was introduced in the 2019 season to reject Limelight’s LED reflections when robots were very close to targets.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/EachInsecureAustraliansilkyterrier-size_restricted.gif"><img alt="https://thumbs.gfycat.com/EachInsecureAustraliansilkyterrier-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/EachInsecureAustraliansilkyterrier-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="target-grouping">
<h4>Target Grouping<a class="headerlink" href="#target-grouping" title="Permalink to this headline">¶</a></h4>
<p>Controls target “grouping”. Set to dual mode to look for “targets” that consist of two shapes, or tri mode to look for targets that consist of three shapes.</p>
<p>Smart Target Grouping can group a variable number of targets and reject outliers. It was added in 2022 to help track the upper hub target.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/HugeCraftyBear-size_restricted.gif"><img alt="https://thumbs.gfycat.com/HugeCraftyBear-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/HugeCraftyBear-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="intersection-filter-dual-targets-only">
<h4>Intersection Filter (Dual Targets Only)<a class="headerlink" href="#intersection-filter-dual-targets-only" title="Permalink to this headline">¶</a></h4>
<p>Rejects groups of contours based on how they would intersect if extended to infinity.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/ThunderousWholeDinosaur-size_restricted.gif"><img alt="https://thumbs.gfycat.com/ThunderousWholeDinosaur-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/ThunderousWholeDinosaur-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="smart-target-grouping">
<h4>Smart Target Grouping<a class="headerlink" href="#smart-target-grouping" title="Permalink to this headline">¶</a></h4>
<dl class="docutils">
<dt>Automatically group targets that pass all individual target filters.</dt>
<dd><ul class="first last simple">
<li>Will dynamically group any number of targets between -group size slider minimum- and -group size slider maximum-</li>
</ul>
</dd>
</dl>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/WetImmediateEarthworm-size_restricted.gif"><img alt="https://thumbs.gfycat.com/WetImmediateEarthworm-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/WetImmediateEarthworm-size_restricted.gif" style="width: 100%;" /></a>
<dl class="docutils">
<dt>Outlier Rejection</dt>
<dd><ul class="first last simple">
<li>While group targets are more challenging than normal targets, they provide more information and opportunities for filtering. If you know that a goal is comprised of multiple targets that are close to each other, you can actually reject outlier targets that stand on their own.</li>
<li>You should rely almost entirely on good target filtering, and only use outlier rejection if you see or expect spurious outliers in your camera stream. If you have poor standard target filtering, outlier detection could begin to work against you!</li>
</ul>
</dd>
</dl>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/CoolQualifiedHedgehog-size_restricted.gif"><img alt="https://thumbs.gfycat.com/CoolQualifiedHedgehog-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/CoolQualifiedHedgehog-size_restricted.gif" style="width: 100%;" /></a>
<hr class="docutils" />
</div>
</div>
<div class="section" id="output">
<span id="id2"></span><h3>Output<a class="headerlink" href="#output" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>This tab controls what happens during the last stage of the vision pipeline</p>
<div class="section" id="targeting-region">
<h4>Targeting Region<a class="headerlink" href="#targeting-region" title="Permalink to this headline">¶</a></h4>
<p>Controls the point of interest of the chosen contour’s bounding rectangle. By default, the tracking parameters tx and ty represent the offsets from your crosshair to the center of the chosen rectangle. You can use another option if a target changes in size, or is comprised of two targets that sometimes blend together.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/FakeThinAfricanbushviper-size_restricted.gif"><img alt="https://thumbs.gfycat.com/FakeThinAfricanbushviper-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/FakeThinAfricanbushviper-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="send-raw-corners">
<h4>Send Raw Corners?<a class="headerlink" href="#send-raw-corners" title="Permalink to this headline">¶</a></h4>
<p>Set this control to “yes” to submit raw corners over network tables. Tune the number of corners submitted by adjusting the “Contour Simplification” value in the “Contour Filtering” page.</p>
</div>
<div class="section" id="send-raw-contours">
<h4>Send Raw Contours?<a class="headerlink" href="#send-raw-contours" title="Permalink to this headline">¶</a></h4>
<p>Set this control to “yes” to submit raw contours over network tables. The top 3 passing contours will be submitted.</p>
</div>
<div class="section" id="crosshair-calibration">
<h4>Crosshair Calibration<a class="headerlink" href="#crosshair-calibration" title="Permalink to this headline">¶</a></h4>
<p>Controls the “origin” of your targeting values. Let’s say a shooter on your robot needs to be calibrated such that it always points a bit left-of-center. You can line up your robot, click “calibrate,” and all of your targeting values will be sent relative to your new crosshair. See the calibration page for more details!</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/JauntyTerrificGreatwhiteshark-size_restricted.gif"><img alt="https://thumbs.gfycat.com/JauntyTerrificGreatwhiteshark-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/JauntyTerrificGreatwhiteshark-size_restricted.gif" style="width: 100%;" /></a>
<hr class="docutils" />
</div>
</div>
<div class="section" id="d">
<span id="id3"></span><h3>3D<a class="headerlink" href="#d" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>Experiment with PnP point-based pose estimation here.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/LeftHalfBluewhale-size_restricted.gif"><img alt="https://thumbs.gfycat.com/LeftHalfBluewhale-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/LeftHalfBluewhale-size_restricted.gif" style="width: 100%;" /></a>
<div class="section" id="compute-3d">
<h4>Compute 3D<a class="headerlink" href="#compute-3d" title="Permalink to this headline">¶</a></h4>
<p>Controls whether pose estimation is enabled. You must enable the 960x720 high-res mode for this to work.</p>
</div>
<div class="section" id="force-convex">
<h4>Force Convex<a class="headerlink" href="#force-convex" title="Permalink to this headline">¶</a></h4>
<p>Use this option to select only the “outermost” corners of a target for SolvePnP.</p>
</div>
<div class="section" id="contour-simplification">
<h4>Contour Simplification<a class="headerlink" href="#contour-simplification" title="Permalink to this headline">¶</a></h4>
<p>Use this option to remove small, noisy edges from the target.</p>
</div>
<div class="section" id="acceptable-error">
<h4>Acceptable Error<a class="headerlink" href="#acceptable-error" title="Permalink to this headline">¶</a></h4>
<p>Limelight will only return a target if it passes a reprojection test with a certain score in pixels.</p>
</div>
<div class="section" id="goal-z-offset">
<h4>Goal Z-Offset<a class="headerlink" href="#goal-z-offset" title="Permalink to this headline">¶</a></h4>
<p>Automatically the 3D Depth value of your target (Z-Axis).</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/AcidicHonoredElephant-size_restricted.gif"><img alt="https://thumbs.gfycat.com/AcidicHonoredElephant-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/AcidicHonoredElephant-size_restricted.gif" style="width: 100%;" /></a>
</div>
<div class="section" id="camera-matricies-advanced-users">
<h4>Camera Matricies (Advanced Users)<a class="headerlink" href="#camera-matricies-advanced-users" title="Permalink to this headline">¶</a></h4>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
Limelight 2 960x720</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
Limelight 1 960x720</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">cameraMatrix</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Matx33d</span><span class="p">(</span>
                        <span class="mf">772.53876202</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">479.132337442</span><span class="p">,</span>
                        <span class="mf">0.</span><span class="p">,</span> <span class="mf">769.052151477</span><span class="p">,</span> <span class="mf">359.143001808</span><span class="p">,</span>
                        <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
<span class="n">distortionCoefficient</span> <span class="o">=</span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="p">{</span>
                        <span class="mf">2.9684613693070039e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.4380252254747885e+00</span><span class="p">,</span><span class="o">-</span><span class="mf">2.2098421479494509e-03</span><span class="p">,</span>
                        <span class="o">-</span><span class="mf">3.3894563533907176e-03</span><span class="p">,</span> <span class="mf">2.5344430354806740e+00</span><span class="p">};</span>

<span class="n">focalLength</span> <span class="o">=</span> <span class="mf">2.9272781257541</span><span class="p">;</span> <span class="c1">//mm</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">cameraMatrix</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Matx33d</span><span class="p">(</span>
                <span class="mf">8.8106888208290547e+02</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">4.8844767170376019e+02</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span> <span class="mf">8.7832357838726318e+02</span><span class="p">,</span> <span class="mf">3.5819038625928994e+02</span><span class="p">,</span>
                <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>
<span class="n">distortionCoefficient</span> <span class="o">=</span>  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="p">{</span>
                <span class="mf">1.3861168261860063e-01</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.4784067711324946e-01</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">2.2878279907387667e-03</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.8260257487769065e-04</span><span class="p">,</span>
                <span class="mf">5.0520158005588123e-01</span> <span class="p">};</span>

<span class="n">focalLength</span> <span class="o">=</span> <span class="mf">3.3385168390258093</span><span class="p">;</span> <span class="c1">//mm</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<span id="document-crosshair_calibration"></span><div class="section" id="crosshair-calibration">
<h2>Crosshair Calibration<a class="headerlink" href="#crosshair-calibration" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="#single-crosshair"><span class="std std-ref">Single Crosshair Mode</span></a></li>
<li><a class="reference internal" href="#dual-crosshair"><span class="std std-ref">Dual Crosshair Mode</span></a></li>
</ul>
<p>Limelight’s crosshairs turn calibration into a seamless process. Rather than storing offsets in their code, teams can line-up their robots perfectly by hand (or by joystick), and click the “calibrate” button.</p>
<p>Calibrating a crosshair moves the “zero” of your targeting data. This is very useful if your Limelight isn’t perfectly centered on your robot.</p>
<div class="section" id="single-crosshair-mode">
<span id="single-crosshair"></span><h3>Single Crosshair Mode<a class="headerlink" href="#single-crosshair-mode" title="Permalink to this headline">¶</a></h3>
<p>Line-up your robot at its ideal scoring location+rotation, and click “calibrate”. Now a tx and ty of “zero” equate to a perfectly aligned robot. If your robot needs to be recalibrated for a new field, simply take a practice match to find the perfect alignment for your robot, and click “calibrate” during your match.</p>
</div>
<div class="section" id="dual-crosshair-mode">
<span id="dual-crosshair"></span><h3>Dual Crosshair Mode<a class="headerlink" href="#dual-crosshair-mode" title="Permalink to this headline">¶</a></h3>
<p>Imagine a robot with an off-axis camera or shooter that needs to shoot gameobjects into a goal from many positions on the field. As the robot approaches the goal, its crosshair must adjust in real-time to compensate. Dual crosshair mode is built for this functionality. Line-up your robot at its closest scoring position+rotation, and calibrate crosshair “A”. Line-up your robot at its farthest scoring position+rotation, and calibrate crosshair “B”. When you calibrate in dual-crosshair mode, crosshairs also store an area value. You will notice that as your robot moves between its min and max scoring distances, the crosshair moves between crosshair “A” and crosshair “B”. This is done by checking the area of the target, and comparing it to the two target areas seen during calibration.</p>
</div>
</div>
<span id="document-using_multiple_pipelines"></span><div class="section" id="using-multiple-pipelines">
<h2>Using Multiple Pipelines<a class="headerlink" href="#using-multiple-pipelines" title="Permalink to this headline">¶</a></h2>
<p>Limelight can store up to ten unique vision pipelines for different goals, different fields, or different robots. Change pipelines mid-match by changing the “pipeline” value in NetworkTables.</p>
<p>To edit multiple pipelines, you must first check the “Ignore NetworkTables Index” checkbox in the web interface. This will force the robot to temporarily allow you to change the pipline index through the webinterface rather than through NetworkTables.</p>
<p>To download your pipelines for backups and sharing, simply click the “download” button next to your pipeline’s name. To upload a pipeline, click the “upload” button.</p>
<p>Here’s an example of a robot that utilizes two pipelines:</p>
<img alt="https://thumbs.gfycat.com/UnfitLankyHadrosaurus-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/UnfitLankyHadrosaurus-size_restricted.gif" />
<p>The first pipeline is tuned to target single vertical stripes. The second pipeline is tuned to find a combo of two horizontal stripes. The code for this robot is available in the “Aim and Range” case study.</p>
<p>Notice that when the robot switches pipelines, the web interface auto-loads the new pipeline.</p>
</div>
<span id="document-best_practices"></span><div class="section" id="best-practices">
<h2>Best Practices<a class="headerlink" href="#best-practices" title="Permalink to this headline">¶</a></h2>
<div class="section" id="before-an-event">
<h3>Before An Event<a class="headerlink" href="#before-an-event" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Download and backup all pipelines to your programming laptop.</li>
<li>Download a copy of the latest Limelight image to your programming laptop.</li>
<li><dl class="first docutils">
<dt>Record a list of your pipelines and their indicies.</dt>
<dd><ul class="first last">
<li>1 - Dual Target Low</li>
<li>2 - Dual Target High Cargo</li>
</ul>
</dd>
</dl>
</li>
<li>Add strain reliefs to all power and ethernet cables going to your LL.</li>
<li>Consider hot-gluing all connections.</li>
<li>Make sure you are using a dashboard (Smartdashboard, Shuffleboard) and not a web browser to view the stream while practicing and during events. Default web controls don’t have the ability to auto-reconnect to streams after spurious disconnections, but SmartDashboard and Shuffleboard both have auto-reconnection built-in by default.</li>
<li>Add a network switch to your robot to enable ethernet tethering while at an event and to avoid the second radio port. We recommend the <a class="reference external" href="https://www.amazon.com/BRAINBOXES-SW-005-Brainboxes-Unmanaged-Ethernet/dp/B07PRZ2R1P/">Branboxes SW-005 5 port Switch</a></li>
<li>We do not recommend use of the second radio port. Route all devices through your network switch if possible.</li>
<li><dl class="first docutils">
<dt>Setup <a class="reference external" href="https://docs.wpilib.org/en/latest/docs/networking/networking-utilities/portforwarding.html">Port Forwarding</a> to enable Limelight communication while tethered to your robot over USB.</dt>
<dd><ul class="first last">
<li>Forward ports 5800, 5801, 5802, 5803, 5804, and 5805</li>
</ul>
</dd>
</dl>
</li>
</ul>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
Java</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
C++</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">edu.wpi.first.wpiutil.net.PortForwarder</span><span class="p">;</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">robotInit</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Make sure you only configure port forwarding once in your robot code.</span>
    <span class="c1">// Do not place these function calls in any periodic functions</span>
    <span class="n">PortForwarder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">5800</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5800</span><span class="p">);</span>
    <span class="n">PortForwarder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">5801</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5801</span><span class="p">);</span>
    <span class="n">PortForwarder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">5802</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5802</span><span class="p">);</span>
    <span class="n">PortForwarder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">5803</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5803</span><span class="p">);</span>
    <span class="n">PortForwarder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">5804</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5804</span><span class="p">);</span>
    <span class="n">PortForwarder</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="mi">5805</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5805</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;wpi/PortForwarder.h&gt;</span><span class="cp"></span>
<span class="kt">void</span> <span class="n">Robot</span><span class="o">::</span><span class="n">RobotInit</span>
<span class="p">{</span>
    <span class="n">wpi</span><span class="o">::</span><span class="n">PortForwarder</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Add</span><span class="p">(</span><span class="mi">5800</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5800</span><span class="p">);</span>
    <span class="n">wpi</span><span class="o">::</span><span class="n">PortForwarder</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Add</span><span class="p">(</span><span class="mi">5801</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5801</span><span class="p">);</span>
    <span class="n">wpi</span><span class="o">::</span><span class="n">PortForwarder</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Add</span><span class="p">(</span><span class="mi">5802</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5802</span><span class="p">);</span>
    <span class="n">wpi</span><span class="o">::</span><span class="n">PortForwarder</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Add</span><span class="p">(</span><span class="mi">5803</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5803</span><span class="p">);</span>
    <span class="n">wpi</span><span class="o">::</span><span class="n">PortForwarder</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Add</span><span class="p">(</span><span class="mi">5804</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5804</span><span class="p">);</span>
    <span class="n">wpi</span><span class="o">::</span><span class="n">PortForwarder</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">().</span><span class="n">Add</span><span class="p">(</span><span class="mi">5805</span><span class="p">,</span> <span class="s">&quot;limelight.local&quot;</span><span class="p">,</span> <span class="mi">5805</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="during-event-calibration">
<h3>During Event Calibration<a class="headerlink" href="#during-event-calibration" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>Roll your robot to each target on the field.</dt>
<dd><ul class="first last">
<li>Make sure your thresholding is working properly. Switch to the “threshold” view during this process (located under the image stream).</li>
<li>Roll your robot close to the target, and far away from the target. Ensure crosshairs are calibrated properly.</li>
<li>While far away from the target, rotate your robot left and right ~ 30 degrees to ensure that other targets will not be erroneously tracked.</li>
<li>See the tuning section below for more tuning tips.</li>
<li>Ensure no other field / arena elements are being accidentally tracked. Check your area and aspect ratio filters if you are picking up arena lights.</li>
<li>Take snapshots of all targets and erroneous targeting. You can use these to tune your pipelines in the pits.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="pipeline-tuning">
<h3>Pipeline Tuning<a class="headerlink" href="#pipeline-tuning" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Use the lowest exposure possible, and increase black level offset until field lights and LED reflections are removed from the image.</li>
<li>Test your thresholding while far away and angled away from your target.</li>
<li>Use 2019.7’s “Smart Speckle Rejection” to filter unwanted LED reflections</li>
</ul>
</div>
<div class="section" id="before-connecting-to-the-field">
<h3>Before Connecting to the Field<a class="headerlink" href="#before-connecting-to-the-field" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt>Give your laptop a static IP configuration.</dt>
<dd><ul class="first last">
<li>IP: 10.TE.AM.5</li>
<li>Subnet Mask: <strong>255.0.0.0</strong></li>
<li>Gateway: 10.TE.AM.1</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Give your RIO a static IP configuration.</dt>
<dd><ul class="first last">
<li>IP: “10.TE.AM.2”</li>
<li>Subnet Mask: <strong>255.255.255.0</strong> <strong>&lt;- NOTE THE DIFFERENCE HERE</strong></li>
<li>Gateway: 10.TE.AM.1</li>
</ul>
</dd>
</dl>
</li>
<li>Give your Limelights unique hostnames (if using multiple).</li>
<li><dl class="first docutils">
<dt>Give your Limelights unique static IP configurations.</dt>
<dd><ul class="first last">
<li>Always start with “.11” addresses and go upward. (10.9.87.11, etc.)</li>
<li><strong>The use of other addresses may cause your units to malfunction when connected to the FMS.</strong></li>
<li>IP: “10.TE.AM.11”</li>
<li>Subnet mask: <strong>255.255.255.0</strong></li>
<li>Gateway: “10.TE.AM.1”</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>Additional information: <a class="reference external" href="https://docs.wpilib.org/en/stable/docs/networking/networking-introduction/ip-configurations.html">https://docs.wpilib.org/en/stable/docs/networking/networking-introduction/ip-configurations.html</a></p>
</div>
<div class="section" id="before-every-match">
<h3>Before Every Match<a class="headerlink" href="#before-every-match" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Check all power and Ethernet cables going to your Limelights.</li>
<li>Check all electrical connections for looseness and frayed wires.</li>
<li>Check all mounting screws / zipties / tape.</li>
<li>Observe ESD precautions at all times.</li>
</ul>
</div>
<div class="section" id="bandwidth">
<h3>Bandwidth<a class="headerlink" href="#bandwidth" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Some teams run two Limelights with two USB cameras while staying well under under the bandwidth limit. Follow the steps below to reduce bandwidth.</li>
<li>Rather than using driver mode, create a “driver” pipeline. Turn down the exposure to reduce stream bandwidth.</li>
<li>Using a USB camera? Use the “stream” NT key to enable picture-in-picture mode. This will dramatically reduce stream bandwidth.</li>
<li>Turn the stream rate to “low” in the settings page if streaming isn’t critical for driving.</li>
<li>Use the 160x120 stream option introduced in 2019.7.</li>
</ul>
</div>
<div class="section" id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Try to access the stream at &lt;IP&gt;:5800 with a web browser. This should help you determine the root of your issues.</li>
<li>Restart your dashboard</li>
<li>Reboot your computer</li>
<li>Reboot your robot if the field has been reset</li>
<li>Broken Ethernet cables can be the cause of intermittent networking issues.</li>
<li>Always use static IP configurations on the field.</li>
</ul>
</div>
</div>
<span id="document-theory"></span><div class="section" id="additional-theory">
<h2>Additional Theory<a class="headerlink" href="#additional-theory" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="#vision-targets"><span class="std std-ref">Vision Targets</span></a></li>
<li><a class="reference internal" href="index.html#thresholding"><span class="std std-ref">Thresholding Tab</span></a></li>
<li><a class="reference internal" href="index.html#contour-filtering"><span class="std std-ref">Contour Filtering</span></a></li>
<li><a class="reference internal" href="index.html#output"><span class="std std-ref">Output</span></a></li>
</ul>
<hr class="docutils" />
<div class="section" id="vision-targets">
<span id="id1"></span><h3>Vision Targets<a class="headerlink" href="#vision-targets" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>The FRC game designers often place reflective “vision targets” on the field in strategic locations.  These vision targets are usually made out of retro-reflective tape. Major scoring elements generally have vision targets that can be used to automatically aim. Below you can see two examples of some of the vision targets from the 2016 and 2017 FRC games.</p>
<img alt="_images/VisionTargetExamples.jpg" class="align-center" src="_images/VisionTargetExamples.jpg" />
<p>These retro-reflective vision targets have a very useful property: when light is shined at them, it will reflect directly back to the light source.  This is why Limelight has bright green LEDs surrounding its camera lens.  By setting the camera exposure very low while emitting a bright green light toward the target, we can aquire an image that is mostly black with a bright green vision target. This makes the job of aquiring the target relatively easy.</p>
<p>Here you can see an example of the ideal of image.  Notice how almost all of the detail in the image is gone due to the low exposure setting but the retro-reflective tape stands out brightly.</p>
<img alt="_images/VisionTargetExample2.jpg" class="align-center" src="_images/VisionTargetExample2.jpg" />
<hr class="docutils" />
</div>
<div class="section" id="thresholding">
<span id="id2"></span><h3>Thresholding<a class="headerlink" href="#thresholding" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>Thresholding is the next critical component of most FRC vision tracking algorithms. It is the act of taking an image, and throwing away any pixels that aren’t in a specific color range. The result of thresholding is generally a one-dimensional image in which a pixel is either “on” or “off. Thresholding works very well on images that are captured using the above strategy (low exposure, very dark image with a brightly illuminated vision target)</p>
<p>Limelight does thresholding in the HSV (Hue-Saturation-Value) colorspace. You may be used to thinking of colors in the RGB (Red-Green-Blue) colorspace.  HSV is just another way of representing color similar to the way cartesian coordinates or polar coordinates can be used to describe positions.  The reason we use the HSV colorspace is that the Hue can be used to very tightly select the green color that Limelight’s leds output.</p>
<img alt="_images/HSVImage.png" class="align-center" src="_images/HSVImage.png" />
<p>It is critical to adjust your thresholding settings to eliminate as much as you can from the image. You will get the best results if you optimize each stage of your vision pipeline before moving to the next stage. The following image depicts the difference between improper and proper thresholding:</p>
<img alt="_images/thresholdingexample.png" class="align-center" src="_images/thresholdingexample.png" />
<p>Sometimes things like ceiling lights or windows in an arena can be difficult to remove from the image using thresholding, which brings us to the next stage.</p>
<hr class="docutils" />
</div>
<div class="section" id="contour-filtering">
<span id="id3"></span><h3>Contour Filtering<a class="headerlink" href="#contour-filtering" title="Permalink to this headline">¶</a></h3>
<hr class="docutils" />
<p>After thresholding, Limelight’s vision pipeline generates a set of contours for the image.  A contour in is a curve surrounding a contiguous set of pixels.  Sometimes things like ceiling lights, arena scoreboards, windows and other things can make it past the thresholding step.  This is where contour filtering becomes useful.  The goal is to eliminate any contours which we know are not the target we are interested in.</p>
<p>The first and easiest countour filter is to ignore any contours which are smaller than what our vision target looks like from our scoring distance.  Anything smaller than that size is obviously something farther away and should be ignored.  This is called area filtering.</p>
<p>The FRC vision targets often have some geometric property that can be exploited to help us filter contours. For example, if the vision target has a wide aspect ratio, we can filter out any contours that are not wide:</p>
<img alt="_images/Target1.jpg" class="align-center" src="_images/Target1.jpg" />
<p>However, keep in mind that your camera may be looking at the target from an odd angle.  This can drastically affect the aspect ratio of its contour.  Be sure to test your settings from a variety of angles to ensure that you do not filter too aggressively and end up ignoring the vision target!</p>
<img alt="_images/Target3.jpg" class="align-center" src="_images/Target3.jpg" />
<p>This next image target is very interesting.  It is one of the best designed vision targets in FRC (in our opinion). Limelight automatically calculates a value called the <strong>fullness</strong> of a contour.  <strong>Fullness</strong> is the ratio between the pixel area of the contour to its convex area.  This particular shape has a very low fullness and you almost never see any ceiling lights, windows, etc with such a low fullness.  So you can very effectively filter out the unwanted contours if your vision target looks like this one.</p>
<img alt="_images/Target0.jpg" class="align-center" src="_images/Target0.jpg" />
<p>Limelight has many options for filtering contours. You can use these options along with what you know about the geometry properties of the particular vision target you are trying to track.</p>
<p>Currently, if multiple contours pass through your filtering options, the largest contour is chosen. In addition, the pipeline prefers to “lock” onto contours using hysteresis. This is a feature that helps prevent flickering between similar targets.</p>
</div>
<div class="section" id="from-pixels-to-angles">
<h3>From Pixels to Angles<a class="headerlink" href="#from-pixels-to-angles" title="Permalink to this headline">¶</a></h3>
<p>The end result of the vision pipeline is a pixel location of the best contour in the image. For most games, we can just aim at the center of the contour. Sometimes it is also useful to aim at the top-center or some other point but essentially we have a pixel coordinate for where we want to aim.  In order to compute the angles to this target, we need to use a little bit of trigonometry.</p>
<p>First we assume that we have a perfect “pinhole” camera.  In practice this can be far from the truth but the limelight’s camera is very close.  (A fisheye lens would be far from this ideal as a counter-example.)</p>
<p>The limelight camera has a horizontal field of view of 54 degrees and a vertical field of view of 41 degrees.  It captures images at 320x240 resolution.  We assume the center of the image is the optical azis of the camera (so the x and y angles for that location are 0,0).  Given these known values, we can use a little trigonometry to compute the angles for any pixel in the image.</p>
<p>The below diagram shows an example target point which we want to compute angles for.  Pixel coordinates start at the upper left corner of the image and are positive to the right and down.</p>
<img alt="_images/Pixels2Angles_1.jpg" class="align-center" src="_images/Pixels2Angles_1.jpg" />
<p>Our first step will be to convert from pixel coordinates to normalized 2D coordinates where 0,0 is the center of the image and 1.0:</p>
<p>(px,py) = pixel coordinates, 0,0 is the upper-left, positive down and to the right</p>
<p>(nx,ny) = normalized pixel coordinates, 0,0 is the center, positive right and up</p>
<p>nx = (1/160) * (px - 159.5)</p>
<p>ny = (1/120) * (119.5 - py)</p>
<p>Next we define an imaginary view plane and compute its size.  For simplicity, we can choose to place this plane 1.0 unit in front of the camera location.  Here is a view looking down on the camera.  Our goal is to compute the view plane width and height as those values will be used to compute the angles later:</p>
<img alt="_images/Pixels2Angles_NormalizedCoords.jpg" src="_images/Pixels2Angles_NormalizedCoords.jpg" />
<p>Given a distance of 1.0 unit and a known horizontal and vertical fov, we can compute the size of the view plane rectangle the following formulas:</p>
<p>vpw = 2.0*tan(horizontal_fov/2)</p>
<p>vph = 2.0*tan(vertical_fov/2)</p>
<p>Using these two values, we can now convert between normalized pixel coordinates and view plane coordinates using a simple multiply.</p>
<p>x = vpw/2 * nx;</p>
<p>y = vph/2 * ny;</p>
<p>Remember that we chose our view plane to be positioned at a distance of 1.0.  Now we have everything we need to compute the angles to the target point.</p>
<img alt="_images/Pixels2Angles_AngleCalc.jpg" class="align-center" src="_images/Pixels2Angles_AngleCalc.jpg" />
<p>tan(ax) = x / 1</p>
<p>tan(ay) = y / 1</p>
<p>ax = atan2(1,x)</p>
<p>ay = atan2(1,y)</p>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-networktables_api"></span><div class="section" id="complete-networktables-api">
<h2>Complete NetworkTables API<a class="headerlink" href="#complete-networktables-api" title="Permalink to this headline">¶</a></h2>
<p>“Best” Contour information:</p>
<p>Use the following code:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
Java</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
LabView</div>
</div>
<div class="item sphinx-data-tab-0-2 docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-0-3 docutils container">
<div class="docutils container">
Python</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">NetworkTableInstance</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">getTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">).</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;&lt;variablename&gt;&quot;</span><span class="p">).</span><span class="na">getDouble</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<img alt="_images/Labview_ReadData.png" src="_images/Labview_ReadData.png" />
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-2 docutils container">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">nt</span><span class="o">::</span><span class="n">NetworkTableInstance</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;&lt;variablename&gt;&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-3 docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NetworkTables</span><span class="o">.</span><span class="n">getTable</span><span class="p">(</span><span class="s2">&quot;limelight&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">getNumber</span><span class="p">(</span><span class="s1">&#39;&lt;variablename&gt;&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>to retrieve this data:</p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>tv</td>
<td>Whether the limelight has any valid targets (0 or 1)</td>
</tr>
<tr class="row-even"><td>tx</td>
<td>Horizontal Offset From Crosshair To Target (LL1: -27 degrees to 27 degrees | LL2: -29.8 to 29.8 degrees)</td>
</tr>
<tr class="row-odd"><td>ty</td>
<td>Vertical Offset From Crosshair To Target (LL1: -20.5 degrees to 20.5 degrees | LL2: -24.85 to 24.85 degrees)</td>
</tr>
<tr class="row-even"><td>ta</td>
<td>Target Area (0% of image to 100% of image)</td>
</tr>
<tr class="row-odd"><td>ts</td>
<td>Skew or rotation (-90 degrees to 0 degrees)</td>
</tr>
<tr class="row-even"><td>tl</td>
<td>The pipeline’s latency contribution (ms) Add at least 11ms for image capture latency.</td>
</tr>
<tr class="row-odd"><td>tshort</td>
<td>Sidelength of shortest side of the fitted bounding box (pixels)</td>
</tr>
<tr class="row-even"><td>tlong</td>
<td>Sidelength of longest side of the fitted bounding box (pixels)</td>
</tr>
<tr class="row-odd"><td>thor</td>
<td>Horizontal sidelength of the rough bounding box (0 - 320 pixels)</td>
</tr>
<tr class="row-even"><td>tvert</td>
<td>Vertical sidelength of the rough bounding box (0 - 320 pixels)</td>
</tr>
<tr class="row-odd"><td>getpipe</td>
<td>True active pipeline index of the camera (0 .. 9)</td>
</tr>
<tr class="row-even"><td>camtran</td>
<td>Results of a 3D position solution, NumberArray: Translation (x,y,z) Rotation(pitch,yaw,roll)</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>tc</td>
<td>Get the average HSV color underneath the crosshair region as a NumberArray</td>
</tr>
</tbody>
</table>
<div class="section" id="camera-controls">
<h3>Camera Controls<a class="headerlink" href="#camera-controls" title="Permalink to this headline">¶</a></h3>
<p>Use the following code:</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-1-0 docutils container">
<div class="docutils container">
Java</div>
</div>
<div class="item sphinx-data-tab-1-1 docutils container">
<div class="docutils container">
LabView</div>
</div>
<div class="item sphinx-data-tab-1-2 docutils container">
<div class="docutils container">
C++</div>
</div>
<div class="item sphinx-data-tab-1-3 docutils container">
<div class="docutils container">
Python</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-0 active docutils container">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">NetworkTableInstance</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">getTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">).</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;&lt;variablename&gt;&quot;</span><span class="p">).</span><span class="na">setNumber</span><span class="p">(</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-1 docutils container">
<img alt="_images/Labview_WriteData.png" src="_images/Labview_WriteData.png" />
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-2 docutils container">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">nt</span><span class="o">::</span><span class="n">NetworkTableInstance</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">PutNumber</span><span class="p">(</span><span class="s">&quot;&lt;variablename&gt;&quot;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-1-3 docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">NetworkTables</span><span class="o">.</span><span class="n">getTable</span><span class="p">(</span><span class="s2">&quot;limelight&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">putNumber</span><span class="p">(</span><span class="s1">&#39;&lt;variablename&gt;&#39;</span><span class="p">,</span><span class="o">&lt;</span><span class="n">value</span><span class="o">&gt;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>to set this data:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>ledMode</td>
<td>Sets limelight’s LED state</td>
</tr>
<tr class="row-even"><td>0</td>
<td>use the LED Mode set in the current pipeline</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>force off</td>
</tr>
<tr class="row-even"><td>2</td>
<td>force blink</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>force on</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>camMode</td>
<td>Sets limelight’s operation mode</td>
</tr>
<tr class="row-even"><td>0</td>
<td>Vision processor</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>Driver Camera (Increases exposure, disables vision processing)</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>pipeline</td>
<td>Sets limelight’s current pipeline</td>
</tr>
<tr class="row-even"><td>0 .. 9</td>
<td>Select pipeline 0..9</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="91%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>stream</td>
<td>Sets limelight’s streaming mode</td>
</tr>
<tr class="row-even"><td>0</td>
<td>Standard - Side-by-side streams if a webcam is attached to Limelight</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>PiP Main - The secondary camera stream is placed in the lower-right corner of the primary camera stream</td>
</tr>
<tr class="row-even"><td>2</td>
<td>PiP Secondary - The primary camera stream is placed in the lower-right corner of the secondary camera stream</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>snapshot</td>
<td>Allows users to take snapshots during a match</td>
</tr>
<tr class="row-even"><td>0</td>
<td>Reset snapshot mode</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>Take exactly one snapshot</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="93%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>crop</td>
<td>Sets the crop rectangle. The pipeline must utilize the default crop rectangle in the web interface. The array must have exactly 4 entries.</td>
</tr>
<tr class="row-even"><td>[0]</td>
<td>X0 - Min or Max X value of crop rectangle (-1 to 1)</td>
</tr>
<tr class="row-odd"><td>[1]</td>
<td>X1 - Min or Max X value of crop rectangle (-1 to 1)</td>
</tr>
<tr class="row-even"><td>[2]</td>
<td>Y0 - Min or Max Y value of crop rectangle (-1 to 1)</td>
</tr>
<tr class="row-odd"><td>[3]</td>
<td>Y1 - Min or Max Y value of crop rectangle (-1 to 1)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="python">
<h3>Python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h3>
<p>Python scripts allow for arbitrary inbound and outbound data.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>llpython</td>
<td>NumberArray sent by python scripts. This is accessible from robot code.</td>
</tr>
<tr class="row-even"><td>llrobot</td>
<td>NumberArray sent by the robot. This is accessible from python scripts.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="corners">
<h3>Corners<a class="headerlink" href="#corners" title="Permalink to this headline">¶</a></h3>
<p>Enable “send contours” in the “Output” tab to stream corner coordinates:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>tcornxy</td>
<td>Number array of corner coordinates [x0,y0,x1,y1……]</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="advanced-usage-with-raw-contours">
<h3>Advanced Usage with Raw Contours<a class="headerlink" href="#advanced-usage-with-raw-contours" title="Permalink to this headline">¶</a></h3>
<p>Raw Targets:</p>
<p>Limelight posts three raw contours to NetworkTables that are not influenced by your grouping mode. That is, they are filtered with your pipeline parameters, but never grouped. X and Y are returned in normalized screen space (-1 to 1) rather than degrees.</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>tx0</td>
<td>Raw Screenspace X</td>
</tr>
<tr class="row-even"><td>ty0</td>
<td>Raw Screenspace Y</td>
</tr>
<tr class="row-odd"><td>ta0</td>
<td>Area (0% of image to 100% of image)</td>
</tr>
<tr class="row-even"><td>ts0</td>
<td>Skew or rotation (-90 degrees to 0 degrees)</td>
</tr>
<tr class="row-odd"><td>tx1</td>
<td>Raw Screenspace X</td>
</tr>
<tr class="row-even"><td>ty1</td>
<td>Raw Screenspace Y</td>
</tr>
<tr class="row-odd"><td>ta1</td>
<td>Area (0% of image to 100% of image)</td>
</tr>
<tr class="row-even"><td>ts1</td>
<td>Skew or rotation (-90 degrees to 0 degrees)</td>
</tr>
<tr class="row-odd"><td>tx2</td>
<td>Raw Screenspace X</td>
</tr>
<tr class="row-even"><td>ty2</td>
<td>Raw Screenspace Y</td>
</tr>
<tr class="row-odd"><td>ta2</td>
<td>Area (0% of image to 100% of image)</td>
</tr>
<tr class="row-even"><td>ts2</td>
<td>Skew or rotation (-90 degrees to 0 degrees)</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<p>Raw Crosshairs:</p>
<p>If you are using raw targeting data, you can still utilize your calibrated crosshairs:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cx0</td>
<td>Crosshair A X in normalized screen space</td>
</tr>
<tr class="row-even"><td>cy0</td>
<td>Crosshair A Y in normalized screen space</td>
</tr>
<tr class="row-odd"><td>cx1</td>
<td>Crosshair B X in normalized screen space</td>
</tr>
<tr class="row-even"><td>cy1</td>
<td>Crosshair B Y in normalized screen space</td>
</tr>
</tbody>
</table>
</div>
</div>
<span id="document-cs_estimating_distance"></span><div class="section" id="case-study-estimating-distance">
<h2>Case Study: Estimating Distance<a class="headerlink" href="#case-study-estimating-distance" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="#fixed-angle-camera"><span class="std std-ref">Using a Fixed Angle Camera</span></a></li>
<li><a class="reference internal" href="#using-area"><span class="std std-ref">Using Area to Estimate Distance</span></a></li>
</ul>
<div class="section" id="using-a-fixed-angle-camera">
<span id="fixed-angle-camera"></span><h3>Using a Fixed Angle Camera<a class="headerlink" href="#using-a-fixed-angle-camera" title="Permalink to this headline">¶</a></h3>
<p>If your vision tracking camera is mounted on your robot such that the angle between the ground plane and its line of sight does not change, then you can use this technique to very accurately calculate the distance to a target.  You can then use this distance value to either drive your robot forward and back to get into the perfect range or adjust the power of a launching mechanism.</p>
<p>See the below diagram.  In this context, all of the variables are known: the height of the target (h2) is known because it is a property of the field.  The height of your camera above the floor (h1) is known and its mounting angle is known (a1).  The limelight (or your vision system) can tell you the y angle to the target (a2).</p>
<img alt="_images/DistanceEstimation.jpg" class="align-center" src="_images/DistanceEstimation.jpg" />
<p>We can solve for d using the following equation:</p>
<p>tan(a1+a2) = (h2-h1) / d</p>
<p>d = (h2-h1) / tan(a1+a2)</p>
<p>The tan function usually expects an input measured in radians. To convert an angle measurement from degrees to radians, multiply the angle measurement by (3.14159/180.0). See the full code example below.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
Java</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
C++</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">NetworkTable</span> <span class="n">table</span> <span class="o">=</span> <span class="n">NetworkTableInstance</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">getTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
<span class="n">NetworkTableEntry</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;ty&quot;</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">targetOffsetAngle_Vertical</span> <span class="o">=</span> <span class="n">ty</span><span class="p">.</span><span class="na">getDouble</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span>

<span class="c1">// how many degrees back is your limelight rotated from perfectly vertical?</span>
<span class="kt">double</span> <span class="n">limelightMountAngleDegrees</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">;</span>

<span class="c1">// distance from the center of the Limelight lens to the floor</span>
<span class="kt">double</span> <span class="n">limelightLensHeightInches</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">;</span>

<span class="c1">// distance from the target to the floor</span>
<span class="kt">double</span> <span class="n">goalHeightInches</span> <span class="o">=</span> <span class="mf">60.0</span><span class="p">;</span>

<span class="kt">double</span> <span class="n">angleToGoalDegrees</span> <span class="o">=</span> <span class="n">limelightMountAngleDegrees</span> <span class="o">+</span> <span class="n">targetOffsetAngle_Vertical</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">angleToGoalRadians</span> <span class="o">=</span> <span class="n">angleToGoalDegrees</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.14159</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">);</span>

<span class="c1">//calculate distance</span>
<span class="kt">double</span> <span class="n">distanceFromLimelightToGoalInches</span> <span class="o">=</span> <span class="p">(</span><span class="n">goalHeightInches</span> <span class="o">-</span> <span class="n">limelightHeightInches</span><span class="p">)</span><span class="o">/</span><span class="n">Math</span><span class="p">.</span><span class="na">tan</span><span class="p">(</span><span class="n">angleToGoalRadians</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NetworkTable</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">nt</span><span class="o">::</span><span class="n">NetworkTableInstance</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">targetOffsetAngle_Vertical</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ty&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>

<span class="c1">// how many degrees back is your limelight rotated from perfectly vertical?</span>
<span class="kt">double</span> <span class="n">limelightMountAngleDegrees</span> <span class="o">=</span> <span class="mf">25.0</span><span class="p">;</span>

<span class="c1">// distance from the center of the Limelight lens to the floor</span>
<span class="kt">double</span> <span class="n">limelightLensHeightInches</span> <span class="o">=</span> <span class="mf">20.0</span><span class="p">;</span>

<span class="c1">// distance from the target to the floor</span>
<span class="kt">double</span> <span class="n">goalHeightInches</span> <span class="o">=</span> <span class="mf">60.0</span><span class="p">;</span>

<span class="kt">double</span> <span class="n">angleToGoalDegrees</span> <span class="o">=</span> <span class="n">limelightMountAngleDegrees</span> <span class="o">+</span> <span class="n">targetOffsetAngle_Vertical</span><span class="p">;</span>
<span class="kt">double</span> <span class="n">angleToGoalRadians</span> <span class="o">=</span> <span class="n">angleToGoalDegrees</span> <span class="o">*</span> <span class="p">(</span><span class="mf">3.14159</span> <span class="o">/</span> <span class="mf">180.0</span><span class="p">);</span>

<span class="c1">//calculate distance</span>
<span class="kt">double</span> <span class="n">distanceFromLimelightToGoalInches</span> <span class="o">=</span> <span class="p">(</span><span class="n">goalHeightInches</span> <span class="o">-</span> <span class="n">limelightHeightInches</span><span class="p">)</span><span class="o">/</span><span class="n">tan</span><span class="p">(</span><span class="n">angleToGoalRadians</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>When using this technique it is important to choose the mounting angle of your camera carefully.  You want to be able to see the target both when you’re too close and too far away.  You also do not want this angle to change, so mount it securely and avoid using slots in your mounting geometry.</p>
<p>If you are having trouble figuring out what the angle a1 is, you can also use the above equation to solve for a1.  Just put your robot at a known distance (measuring from the lens of your camera) and solve the same equation for a1.</p>
<p>In the case where your target is at nearly the same height as your camera, this technique is not useful.</p>
</div>
<div class="section" id="using-area-to-estimate-distance">
<span id="using-area"></span><h3>Using Area to Estimate Distance<a class="headerlink" href="#using-area-to-estimate-distance" title="Permalink to this headline">¶</a></h3>
<p>Another simple way to estimate distance is to use the area of the contour you are tracking.  This is a very simple method to implement but it does not give you extremely accurate results.  All you do is point your vision camera at the target from a known distance and take note of the area of the blob.  Make sure you’re using an accurate representation of the real field’s vision target and make sure you’re pointing at it from your desired shooting location.  You can then do this from a few different distances and make a table out of these values.  In 2016 we used this method to adjust the aim of our 2-axis turret based on how far from the goal we were.</p>
</div>
</div>
<span id="document-cs_aiming"></span><div class="section" id="case-study-aiming-using-vision">
<h2>Case Study: Aiming Using Vision<a class="headerlink" href="#case-study-aiming-using-vision" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>You can accurately and quickly aim your robot using only a limelight and your drivetrain.</li>
<li>We added the limelight to a robot, implemented the code and tuned it in less than 1hr.</li>
</ol>
<p>Using high-framerate vision tracking, it is now possible to use the vision pipeline directly as the “sensor” in a PID control loop to guide your robot or turret.  In order to test this idea we added a limelight to our 2017 FRC robotand made it aim at vision targets using nothing more than the drivetrain and the networks table data being reported by the limelight.</p>
<p>In this example, our test candidate was a 2017 FRC robot which uses a 6-wheel drivetrain with colson wheels.  Here is a picture of us adding a limelight onto the robot in order to do this test.</p>
<img alt="_images/CS_aim_limelight_mounted.JPG" src="_images/CS_aim_limelight_mounted.JPG" />
<p>Next we added some code to the robot which would run whenever the driver holds a button on the joystick.  This robot used “tank” style driving so the OperatorControl function was generating a ‘left_command’ value and a ‘right_command’ value to control the left and right sides of the drivetrain.  After the normal control code, we added a block of code like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="n">Kp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1f</span><span class="p">;</span>  <span class="c1">// Proportional control constant</span>

<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NetworkTable</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">NetworkTable</span><span class="o">::</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;tx&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">joystick</span><span class="o">-&gt;</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="p">{</span>
        <span class="kt">float</span> <span class="n">heading_error</span> <span class="o">=</span> <span class="n">tx</span><span class="p">;</span>
        <span class="n">steering_adjust</span> <span class="o">=</span> <span class="n">Kp</span> <span class="o">*</span> <span class="n">tx</span><span class="p">;</span>

        <span class="n">left_command</span><span class="o">+=</span><span class="n">steering_adjust</span><span class="p">;</span>
        <span class="n">right_command</span><span class="o">-=</span><span class="n">steering_adjust</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Right off the bat, this mostly worked.  The robot turns in the direction of the target automatically whenever you are holding the button.  If you move the target around, the robot turns to follow the target.  However, using the live video feed on the dashboard, we could see that there was one big problem:  The robot wasn’t always making it all the way to perfectly align with the target.  In some games with small targets, (like 2016 and 2017) this wouldn’t be good enough.</p>
<p>What we have implemented so far is a simple proportional control loop.  We calculated the error in heading and multiplied that by a constant, thus making a motor command which is proportional to the error.  As the error goes to zero, our command will go to zero.  The problem is that there is a lot of friction involved when the robot tries to turn.  Very small commands will not turn the robot at all.  At small angles, the command can become too small to actually move the robot.  You might find that your robot reaches its target well when you start out with a large targeting error but it just can’t aim at all if you start out really close.</p>
<p>There are a few ways to solve this problem but here is a really simple solution.  We used a concept the “minimum command”.  If the error is bigger than some threshhold, just add a constant to your motor command which roughly represents the minimum amount of power needed for the robot to actually move (you actually want to use a little bit less than this).  The new code looks like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="n">Kp</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1f</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">min_command</span> <span class="o">=</span> <span class="mf">0.05f</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NetworkTable</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">NetworkTable</span><span class="o">::</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;tx&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">joystick</span><span class="o">-&gt;</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="p">{</span>
        <span class="kt">float</span> <span class="n">heading_error</span> <span class="o">=</span> <span class="o">-</span><span class="n">tx</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">steering_adjust</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tx</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">steering_adjust</span> <span class="o">=</span> <span class="n">Kp</span><span class="o">*</span><span class="n">heading_error</span> <span class="o">-</span> <span class="n">min_command</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">tx</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">steering_adjust</span> <span class="o">=</span> <span class="n">Kp</span><span class="o">*</span><span class="n">heading_error</span> <span class="o">+</span> <span class="n">min_command</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">left_command</span> <span class="o">+=</span> <span class="n">steering_adjust</span><span class="p">;</span>
        <span class="n">right_command</span> <span class="o">-=</span> <span class="n">steering_adjust</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Beware, if you set Kp or min_command too high, your robot can become unstable and can oscillate back and forth as it overshoots the target:</p>
<img alt="_images/CS_aim_bad.gif" src="_images/CS_aim_bad.gif" />
<p>After some tuning on Kp and min_command should get your robot aiming directly at the target very accurately and quickly.</p>
<img alt="_images/CS_aim_good.gif" src="_images/CS_aim_good.gif" />
</div>
<span id="document-cs_seeking"></span><div class="section" id="case-study-seeking">
<h2>Case Study: Seeking<a class="headerlink" href="#case-study-seeking" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Use a seeking behavior to find a target that is not initially visible to the camera.</li>
</ol>
<p>Implementing a seeking behavior can be useful in a few situtations.  In some games, the goal you are trying to score into may not be in a predictable location so you can’t rely on dead-reconing autonomous code to get “close enough”.  In 2009 for example, the goals were attached to the opponents robots which also driving around.  Another reason you might want to implement seeking is if your robot’s drivetrain is not reliable/repeatable enough to put you in exactly the location you want.  Sometimes swerve drives or omni-directional drives can have trouble driving to presice locations (this is not a knock on swerve or omni-directional drivetrains; it is just more challenging to get them to drive to repeatable locations).  Some games have even allowed robot-robot interaction during autonomous mode.  In 2006 we often engaged in autonomous duels where the defense robots would try to knock the offense robots out of scoring position.  In this case you can’t be sure of anything!  Hopefully this gets you thinking about some ways that having your robot automatically seek for a goal that it can’t initially see might be useful.</p>
<p>Luckily, adding seeking logic to your robot is very easy.  To implement seeking, you simply have your robot scan for a target and once it finds it, start running the aiming code.  We will use the ‘tv’ or ‘target valid’ value reported by limelight to know if we see a target or not.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NetworkTable</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">NetworkTable</span><span class="o">::</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">tv</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;tv&quot;</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;tx&quot;</span><span class="p">);</span>

<span class="kt">float</span> <span class="n">steering_adjust</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">tv</span> <span class="o">==</span> <span class="mf">0.0f</span><span class="p">)</span>
<span class="p">{</span>
        <span class="c1">// We don&#39;t see the target, seek for the target by spinning in place at a safe speed.</span>
        <span class="n">steering_adjust</span> <span class="o">=</span> <span class="mf">0.3f</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
        <span class="c1">// We do see the target, execute aiming code</span>
        <span class="kt">float</span> <span class="n">heading_error</span> <span class="o">=</span> <span class="n">tx</span><span class="p">;</span>
        <span class="n">steering_adjust</span> <span class="o">=</span> <span class="n">Kp</span> <span class="o">*</span> <span class="n">tx</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">left_command</span><span class="o">+=</span><span class="n">steering_adjust</span><span class="p">;</span>
<span class="n">right_command</span><span class="o">-=</span><span class="n">steering_adjust</span><span class="p">;</span>
</pre></div>
</div>
<p>Note that if your aiming code includes correcting the distance to the target, the robot behavior will be seeking followed by driving to the shooting distance as it aligns with the target.  All of this can be achieved with the very simple code shown above.</p>
<img alt="_images/CS_Seeking_Anim.gif" src="_images/CS_Seeking_Anim.gif" />
</div>
<span id="document-cs_autorange"></span><div class="section" id="case-study-getting-in-range">
<h2>Case Study: Getting in Range<a class="headerlink" href="#case-study-getting-in-range" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Have your robot automatically drive to a desired distance from the target.</li>
<li>A very simple trick using a calibrated cross-hair.</li>
</ol>
<p>FRC robots often need to be positioned a specific distance from a scoring goal in order for their scoring mechanism to work well.  You can use a simple proportional control loop along with limelight’s calibrated cross-hair to very easily have your robot drive to a specific distance from the goal.</p>
<p>For this example, you should make sure that your robot is aimed at the goal.  Later we will combine aiming and distance adjust into one function but for this example we are focusing only on the code that drives the robot to the correct distance.</p>
<p>Similar to the aiming example, here we show a function which can be run in your robot’s update loop.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="n">KpDistance</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1f</span><span class="p">;</span>  <span class="c1">// Proportional control constant for distance</span>
<span class="kt">float</span> <span class="n">current_distance</span> <span class="o">=</span> <span class="n">Estimate_Distance</span><span class="p">();</span>  <span class="c1">// see the &#39;Case Study: Estimating Distance&#39;</span>

<span class="k">if</span> <span class="p">(</span><span class="n">joystick</span><span class="o">-&gt;</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="p">{</span>
        <span class="kt">float</span> <span class="n">distance_error</span> <span class="o">=</span> <span class="n">desired_distance</span> <span class="o">-</span> <span class="n">current_distance</span><span class="p">;</span>
        <span class="n">driving_adjust</span> <span class="o">=</span> <span class="n">KpDistance</span> <span class="o">*</span> <span class="n">distance_error</span><span class="p">;</span>

        <span class="n">left_command</span> <span class="o">+=</span> <span class="n">distance_adjust</span><span class="p">;</span>
        <span class="n">right_command</span> <span class="o">+=</span> <span class="n">distance_adjust</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>With some tuning of the KpDistance setting, your robot should very quickly and accurately drive to the desired distance.  Compared to aiming, driving to the correct distance is usually easier because most robots drive forward and backward much easier than they turn in place.</p>
<p>Next we’ll describe a simple trick to make driving to the correct distance even easier.  Instead of actually calculating the distance, you can use the limelight cross-hair.  Just position your robot at your idea distance from the target and calibrate the y-position of the cross-hair.  Now your y-angle will report as 0.0 when your robot is at the corect distance.  Using this trick, you don’t ever have to actually calculate the actual distance and your code can look something like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="n">KpDistance</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1f</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NetworkTable</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">NetworkTable</span><span class="o">::</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">distance_error</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ty&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">joystick</span><span class="o">-&gt;</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="p">{</span>
        <span class="n">driving_adjust</span> <span class="o">=</span> <span class="n">KpDistance</span> <span class="o">*</span> <span class="n">distance_error</span><span class="p">;</span>

        <span class="n">left_command</span> <span class="o">+=</span> <span class="n">distance_adjust</span><span class="p">;</span>
        <span class="n">right_command</span> <span class="o">+=</span> <span class="n">distance_adjust</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you need to change the shooting distance, just move your robot to the new distance and re-calibrate the limelight crosshair.</p>
<img alt="https://thumbs.gfycat.com/GraveEverlastingFawn-size_restricted.gif" src="https://thumbs.gfycat.com/GraveEverlastingFawn-size_restricted.gif" />
<p>Here is an example of a robot using the above idea.  Note how it backs up to the correct range automatically when the driver stops driving and presses the “aim” button:</p>
<img alt="_images/CS_Distance_00.gif" src="_images/CS_Distance_00.gif" />
</div>
<span id="document-cs_aimandrange"></span><div class="section" id="case-study-aiming-and-range-at-the-same-time">
<h2>Case Study: Aiming and Range at the same time.<a class="headerlink" href="#case-study-aiming-and-range-at-the-same-time" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Put aiming and range adjustment into one function.</li>
</ol>
<img alt="https://thumbs.gfycat.com/UncommonIncomparableDassierat-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/UncommonIncomparableDassierat-size_restricted.gif" />
<p>This example uses code from the aiming and range adjustment examples and puts everything together into one simple function.  Using this, you can get your robot “close” and then use code to automatically aim and drive to the correct distance.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span> <span class="n">KpAim</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1f</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">KpDistance</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.1f</span><span class="p">;</span>
<span class="kt">float</span> <span class="n">min_aim_command</span> <span class="o">=</span> <span class="mf">0.05f</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NetworkTable</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">NetworkTable</span><span class="o">::</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;tx&quot;</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ty&quot;</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">joystick</span><span class="o">-&gt;</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="p">{</span>
        <span class="kt">float</span> <span class="n">heading_error</span> <span class="o">=</span> <span class="o">-</span><span class="n">tx</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">distance_error</span> <span class="o">=</span> <span class="o">-</span><span class="n">ty</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">steering_adjust</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">tx</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">steering_adjust</span> <span class="o">=</span> <span class="n">KpAim</span><span class="o">*</span><span class="n">heading_error</span> <span class="o">-</span> <span class="n">min_aim_command</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">tx</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="n">steering_adjust</span> <span class="o">=</span> <span class="n">KpAim</span><span class="o">*</span><span class="n">heading_error</span> <span class="o">+</span> <span class="n">min_aim_command</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kt">float</span> <span class="n">distance_adjust</span> <span class="o">=</span> <span class="n">KpDistance</span> <span class="o">*</span> <span class="n">distance_error</span><span class="p">;</span>

        <span class="n">left_command</span> <span class="o">+=</span> <span class="n">steering_adjust</span> <span class="o">+</span> <span class="n">distance_adjust</span><span class="p">;</span>
        <span class="n">right_command</span> <span class="o">-=</span> <span class="n">steering_adjust</span> <span class="o">+</span> <span class="n">distance_adjust</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<span id="document-cs_robotexample"></span><div class="section" id="case-study-2017-fuel-robot">
<h2>Case Study: 2017 Fuel Robot<a class="headerlink" href="#case-study-2017-fuel-robot" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Entire c++ robot program which implements 2017 fuel scoring.</li>
</ol>
<p>In this example, we present a complete robot program which implements the 2017 boiler goal.  We tested this program on the 987 steamworks robot and were able to easily score fuel in the boiler.  For this example we aim and move into range using the robot’s drivetrain.  One thing that was immediately apparent to us is that limelight let us implement this feature in a tiny fraction of the amount of code and time compared to our real 2017 robot.</p>
<p>There are also a couple of other features in the code below such as the ability to blink the LEDs and dynamically toggle between multiple vision pipelines.  This example also shows how to use a Talon SRX speed controller along with a magnetic encoder to control the RPM of the shooter wheel.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;Drive/DifferentialDrive.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;Joystick.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;SampleRobot.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;SmartDashboard/SendableChooser.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;SmartDashboard/SmartDashboard.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;Spark.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;Victor.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;Timer.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;ctre/phoenix/MotorControl/CAN/TalonSRX.h&quot;</span><span class="cp"></span>

<span class="c1">//</span>
<span class="cp">#define Vic_Drive_Left_1 0</span>
<span class="cp">#define Vic_Drive_Left_2 1</span>
<span class="cp">#define Vic_Drive_Right_1 2</span>
<span class="cp">#define Vic_Drive_Right_2 3</span>

<span class="cp">#define Tal_Shooter_Wheel 21</span>
<span class="cp">#define Tal_Shooter_Wheel_2 2</span>
<span class="cp">#define Tal_Intake 3</span>
<span class="cp">#define Tal_Uptake 9</span>

<span class="k">class</span> <span class="nc">Robot</span> <span class="o">:</span> <span class="k">public</span> <span class="n">frc</span><span class="o">::</span><span class="n">SampleRobot</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>

<span class="n">Robot</span><span class="p">()</span> <span class="o">:</span>
        <span class="n">LeftDrive</span><span class="p">(</span><span class="n">Vic_Drive_Left_1</span><span class="p">),</span>
        <span class="n">RightDrive</span><span class="p">(</span><span class="n">Vic_Drive_Right_1</span><span class="p">),</span>
        <span class="n">LeftDrive2</span><span class="p">(</span><span class="n">Vic_Drive_Left_2</span><span class="p">),</span>
        <span class="n">RightDrive2</span><span class="p">(</span><span class="n">Vic_Drive_Right_2</span><span class="p">),</span>
        <span class="n">Shooter</span><span class="p">(</span><span class="n">Tal_Shooter_Wheel</span><span class="p">),</span>
        <span class="n">Shooter_2</span><span class="p">(</span><span class="n">Tal_Shooter_Wheel_2</span><span class="p">),</span>
        <span class="n">Intake</span><span class="p">(</span><span class="n">Tal_Intake</span><span class="p">),</span>
        <span class="n">Uptake</span><span class="p">(</span><span class="n">Tal_Uptake</span><span class="p">)</span>
<span class="p">{</span>
        <span class="c1">// This code sets up two Talons to work together and implement PID RPM control</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetControlMode</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">kSpeed</span><span class="p">);</span>
        <span class="n">Shooter_2</span><span class="p">.</span><span class="n">SetControlMode</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">kFollower</span><span class="p">);</span>
        <span class="n">Shooter_2</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="n">Tal_Shooter_Wheel</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetClosedLoopOutputDirection</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetStatusFrameRateMs</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">CAN</span><span class="o">::</span><span class="n">TalonSRX</span><span class="o">::</span><span class="n">StatusFrameRateAnalogTempVbat</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>

        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetFeedbackDevice</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">CAN</span><span class="o">::</span><span class="n">TalonSRX</span><span class="o">::</span><span class="n">CtreMagEncoder_Relative</span><span class="p">);</span>
        <span class="n">SetShooterConstants</span><span class="p">(</span><span class="mf">.0002f</span><span class="p">,</span> <span class="mf">.00009f</span><span class="p">,</span> <span class="mf">.0000f</span><span class="p">,</span> <span class="mf">.000006f</span><span class="p">);</span>  <span class="c1">// P,I,D,F constants for the shooter wheel</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetAllowableClosedLoopErr</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">ConfigNominalOutputVoltage</span><span class="p">(</span><span class="o">+</span><span class="mf">0.f</span><span class="p">,</span><span class="o">-</span><span class="mf">0.f</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">ConfigPeakOutputVoltage</span><span class="p">(</span><span class="o">+</span><span class="mf">12.f</span><span class="p">,</span><span class="o">-</span><span class="mf">12.f</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SelectProfileSlot</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetSensorDirection</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetVoltageRampRate</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetIzone</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
        <span class="n">Shooter_2</span><span class="p">.</span><span class="n">SetVoltageRampRate</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">RobotInit</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Autonomous</span><span class="p">()</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Operator Control</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">OperatorControl</span><span class="p">()</span> <span class="k">override</span>
<span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">IsOperatorControl</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">IsEnabled</span><span class="p">())</span>
        <span class="p">{</span>
                <span class="c1">// Read the joysticks!</span>
                <span class="kt">float</span> <span class="n">left_command</span> <span class="o">=</span> <span class="n">m_stickLeft</span><span class="p">.</span><span class="n">GetY</span><span class="p">();</span>
                <span class="kt">float</span> <span class="n">right_command</span> <span class="o">=</span> <span class="n">m_stickRight</span><span class="p">.</span><span class="n">GetY</span><span class="p">();</span>

                <span class="c1">// Get limelight table for reading tracking data</span>
                <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NetworkTable</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">NetworkTable</span><span class="o">::</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>

                <span class="kt">float</span> <span class="n">KpAim</span> <span class="o">=</span> <span class="mf">0.045</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">KpDist</span> <span class="o">=</span> <span class="mf">0.0f</span><span class="p">;</span> <span class="c1">//0.09;</span>
                <span class="kt">float</span> <span class="n">AimMinCmd</span> <span class="o">=</span> <span class="mf">0.095f</span><span class="p">;</span>

                <span class="kt">float</span> <span class="n">targetX</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;tx&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="kt">float</span> <span class="n">targetY</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ty&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="kt">float</span> <span class="n">targetA</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ta&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

                <span class="c1">// Aim error and distance error based on calibrated limelight cross-hair</span>
                <span class="kt">float</span> <span class="n">aim_error</span> <span class="o">=</span> <span class="n">targetX</span><span class="p">;</span>
                <span class="kt">float</span> <span class="n">dist_error</span> <span class="o">=</span> <span class="n">targetY</span><span class="p">;</span>

                <span class="c1">// Steering adjust with a 0.2 degree deadband (close enough at 0.2deg)</span>
                <span class="kt">float</span> <span class="n">steeringAdjust</span> <span class="o">=</span> <span class="n">KpAim</span><span class="o">*</span><span class="n">aim_error</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">targetX</span> <span class="o">&gt;</span> <span class="mf">.2f</span><span class="p">)</span> <span class="n">steeringAdjust</span> <span class="o">+=</span> <span class="n">AimMinCmd</span><span class="p">;</span>
                <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">targetX</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">.2f</span><span class="p">)</span> <span class="n">steeringAdjust</span> <span class="o">-=</span> <span class="n">AimMinCmd</span><span class="p">;</span>

                <span class="c1">// Distance adjust, drive to the correct distance from the goal</span>
                <span class="kt">float</span> <span class="n">drivingAdjust</span> <span class="o">=</span> <span class="n">KpDist</span><span class="o">*</span><span class="n">dist_error</span><span class="p">;</span>
                <span class="kt">bool</span> <span class="n">doTarget</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

                <span class="k">if</span><span class="p">(</span><span class="n">m_stickLeft</span><span class="p">.</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>         <span class="c1">// Aim using pipeline 0</span>
                <span class="p">{</span>
                        <span class="n">doTarget</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                        <span class="n">table</span><span class="o">-&gt;</span><span class="n">PutNumber</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">m_stickLeft</span><span class="p">.</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>   <span class="c1">// Aim using pipeline 1</span>
                <span class="p">{</span>
                        <span class="n">doTarget</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
                        <span class="n">table</span><span class="o">-&gt;</span><span class="n">PutNumber</span><span class="p">(</span><span class="s">&quot;pipeline&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">if</span><span class="p">(</span><span class="n">doTarget</span><span class="p">)</span>                            <span class="c1">// If auto-aiming, adjust drive and steer</span>
                <span class="p">{</span>
                        <span class="n">ShooterSetRPM</span><span class="p">(</span><span class="mi">3300</span><span class="p">);</span>
                        <span class="n">left_command</span> <span class="o">+=</span> <span class="n">drivingAdjust</span> <span class="o">-</span> <span class="n">steeringAdjust</span><span class="p">;</span>
                        <span class="n">right_command</span> <span class="o">+=</span> <span class="n">drivingAdjust</span> <span class="o">+</span> <span class="n">steeringAdjust</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                        <span class="n">ShooterOff</span><span class="p">();</span>
                <span class="p">}</span>

                <span class="c1">// Tank drive, send left and right drivetrain motor commands</span>
                <span class="n">StandardTank</span><span class="p">(</span><span class="n">left_command</span><span class="p">,</span><span class="n">right_command</span><span class="p">);</span>

                <span class="k">if</span><span class="p">(</span><span class="n">m_stickRight</span><span class="p">.</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>        <span class="c1">// Suck in and shoot balls</span>
                <span class="p">{</span>
                        <span class="n">IntakeIn</span><span class="p">();</span>
                        <span class="n">UptakeUp</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">m_stickRight</span><span class="p">.</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>   <span class="c1">// Spit out balls</span>
                <span class="p">{</span>
                        <span class="n">IntakeIn</span><span class="p">();</span>
                        <span class="n">UptakeDown</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">else</span>                                    <span class="c1">// Leave the balls alone!</span>
                <span class="p">{</span>
                        <span class="n">IntakeOff</span><span class="p">();</span>
                        <span class="n">UptakeOff</span><span class="p">();</span>
                <span class="p">}</span>
                <span class="k">if</span><span class="p">(</span><span class="n">m_stickLeft</span><span class="p">.</span><span class="n">GetRawButton</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>         <span class="c1">// Joystick Button 5 = Flash the LEDs</span>
                <span class="p">{</span>
                        <span class="n">table</span><span class="o">-&gt;</span><span class="n">PutNumber</span><span class="p">(</span><span class="s">&quot;ledMode&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">//flash the lights</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                        <span class="n">table</span><span class="o">-&gt;</span><span class="n">PutNumber</span><span class="p">(</span><span class="s">&quot;ledMode&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">//turn the lights on</span>
                <span class="p">}</span>

                <span class="c1">// wait for a motor update time</span>
                <span class="n">frc</span><span class="o">::</span><span class="n">Wait</span><span class="p">(</span><span class="mf">0.005</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Runs during test mode</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">Test</span><span class="p">()</span> <span class="k">override</span> <span class="p">{}</span>


<span class="kt">void</span> <span class="n">StandardTank</span><span class="p">(</span><span class="kt">float</span> <span class="n">left</span><span class="p">,</span> <span class="kt">float</span> <span class="n">right</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">LeftDrive</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="o">-</span><span class="n">left</span><span class="p">);</span>
        <span class="n">LeftDrive2</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="o">-</span><span class="n">left</span><span class="p">);</span>
        <span class="n">RightDrive</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="n">right</span><span class="p">);</span>
        <span class="n">RightDrive2</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="n">right</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="c1">// Shooter Functions - uses talon PID to control shooter wheel RPM</span>
<span class="c1">// Set the P,I,D,F constants in the Talon, these values depend heavily on your mechanism</span>
<span class="c1">//</span>
<span class="kt">void</span> <span class="n">SetShooterConstants</span><span class="p">(</span><span class="kt">float</span> <span class="n">p</span><span class="p">,</span><span class="kt">float</span> <span class="n">i</span><span class="p">,</span><span class="kt">float</span> <span class="n">d</span><span class="p">,</span><span class="kt">float</span> <span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">p</span> <span class="o">*=</span> <span class="mf">1024.f</span><span class="p">;</span>
        <span class="n">i</span> <span class="o">*=</span> <span class="mf">1024.f</span><span class="p">;</span>
        <span class="n">d</span> <span class="o">*=</span> <span class="mf">1024.f</span><span class="p">;</span>
        <span class="n">f</span> <span class="o">*=</span> <span class="mf">1024.f</span><span class="p">;</span>

        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetP</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetI</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetD</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetF</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="c1">// Tell the talons our desired shooter wheel RPM</span>
<span class="c1">//</span>
<span class="kt">void</span> <span class="n">ShooterSetRPM</span><span class="p">(</span><span class="kt">float</span> <span class="n">desrpm</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetControlMode</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">kSpeed</span><span class="p">);</span>
        <span class="n">Shooter_2</span><span class="p">.</span><span class="n">SetControlMode</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">kFollower</span><span class="p">);</span>
        <span class="n">Shooter_2</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="n">Tal_Shooter_Wheel</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="n">desrpm</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="c1">// Just set the power -1..+1, not currently using this now that RPM control is set up</span>
<span class="c1">//</span>
<span class="kt">void</span> <span class="n">ShooterSetPower</span><span class="p">(</span><span class="kt">float</span> <span class="n">power</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetControlMode</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">kPercentVbus</span><span class="p">);</span>
        <span class="n">Shooter_2</span><span class="p">.</span><span class="n">SetControlMode</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">kPercentVbus</span><span class="p">);</span>
        <span class="n">Shooter_2</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="n">power</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="n">power</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="c1">// Turn off the shooter wheel</span>
<span class="c1">//</span>
<span class="kt">void</span> <span class="n">ShooterOff</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">SetControlMode</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">kPercentVbus</span><span class="p">);</span>
        <span class="n">Shooter_2</span><span class="p">.</span><span class="n">SetControlMode</span><span class="p">(</span><span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">ControlMode</span><span class="o">::</span><span class="n">kPercentVbus</span><span class="p">);</span>
        <span class="n">Shooter</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">);</span>
        <span class="n">Shooter_2</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="c1">// Intake Functions</span>
<span class="c1">//</span>
<span class="kt">void</span> <span class="n">IntakeIn</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">Intake</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="o">-</span><span class="mf">.8f</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">IntakeOut</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">Intake</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="mf">.8f</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">IntakeShooting</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">Intake</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">IntakeOff</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">Intake</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">//</span>
<span class="c1">// Uptake Functions</span>
<span class="c1">//</span>
<span class="kt">void</span> <span class="n">UptakeUp</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">Uptake</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0f</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">UptakeDown</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">Uptake</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">UptakeOff</span><span class="p">()</span>
<span class="p">{</span>
        <span class="n">Uptake</span><span class="p">.</span><span class="n">Set</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span><span class="o">:</span>

        <span class="c1">// Robot drive system</span>
        <span class="n">frc</span><span class="o">::</span><span class="n">Victor</span> <span class="n">LeftDrive</span><span class="p">;</span>
        <span class="n">frc</span><span class="o">::</span><span class="n">Victor</span> <span class="n">RightDrive</span><span class="p">;</span>
        <span class="n">frc</span><span class="o">::</span><span class="n">Victor</span> <span class="n">LeftDrive2</span><span class="p">;</span>
        <span class="n">frc</span><span class="o">::</span><span class="n">Victor</span> <span class="n">RightDrive2</span><span class="p">;</span>

        <span class="c1">// shooter wheel</span>
        <span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">CAN</span><span class="o">::</span><span class="n">TalonSRX</span> <span class="n">Shooter</span><span class="p">;</span>
        <span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">CAN</span><span class="o">::</span><span class="n">TalonSRX</span> <span class="n">Shooter_2</span><span class="p">;</span>
        <span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">CAN</span><span class="o">::</span><span class="n">TalonSRX</span> <span class="n">Intake</span><span class="p">;</span>
        <span class="n">CTRE</span><span class="o">::</span><span class="n">MotorControl</span><span class="o">::</span><span class="n">CAN</span><span class="o">::</span><span class="n">TalonSRX</span> <span class="n">Uptake</span><span class="p">;</span>

        <span class="c1">// Joystick inputs</span>
        <span class="n">frc</span><span class="o">::</span><span class="n">Joystick</span> <span class="n">m_stickLeft</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
        <span class="n">frc</span><span class="o">::</span><span class="n">Joystick</span> <span class="n">m_stickRight</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span>
<span class="p">};</span>

<span class="n">START_ROBOT_CLASS</span><span class="p">(</span><span class="n">Robot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<span id="document-cs_drive_to_goal_2019"></span><div class="section" id="case-study-deep-space-2019-examples">
<h2>Case Study: DEEP SPACE 2019 Examples<a class="headerlink" href="#case-study-deep-space-2019-examples" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Example programs in C++, Java and Labview for using a limelight camera to drive up to a goal in Deep Space.</li>
</ol>
<p>The 2019 FRC game Deep Space has vision targets above many of the goals that you need to drive up to.  Below you can find complete example programs in C++, Java, and Labview which implement a simple method for automatically driving a differential drive robot to a goal in Deep Space.</p>
<p>These are very simple programs and only meant to show the concept of using limelight tracking data to control your robot.  In each program, you can drive your robot with a gamepad.  If you hold the ‘A’ button down, and the limelight sees a valid target (depending on the settings in your pipeline) then the robot will automatically drive towards the target.  Be careful to tune the various constants in the code for your particular robot.  Some robots turn or drive more easily than others so tuning the proportional control constants must be done on a case-by-case basis.  Also make sure the robot drives correctly using the gamepad controller before enabling the limelight seeking behavior.  You may need to invert some of your motor controllers.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-0-0 docutils container">
<div class="docutils container">
Java</div>
</div>
<div class="item sphinx-data-tab-0-1 docutils container">
<div class="docutils container">
C++ Header</div>
</div>
<div class="item sphinx-data-tab-0-2 docutils container">
<div class="docutils container">
C++ Source</div>
</div>
<div class="item sphinx-data-tab-0-3 docutils container">
<div class="docutils container">
LabView</div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-0 active docutils container">
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">frc.robot</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.TimedRobot</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.smartdashboard.SendableChooser</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.smartdashboard.SmartDashboard</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.VictorSP</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.SpeedControllerGroup</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.XboxController</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.GenericHID.Hand</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.wpilibj.drive.DifferentialDrive</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">edu.wpi.first.networktables.*</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * The VM is configured to automatically run this class, and to call the</span>
<span class="cm"> * functions corresponding to each mode, as described in the TimedRobot</span>
<span class="cm"> * documentation. If you change the name of this class or the package after</span>
<span class="cm"> * creating this project, you must also update the build.gradle file in the</span>
<span class="cm"> * project.</span>
<span class="cm"> */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Robot</span> <span class="kd">extends</span> <span class="n">TimedRobot</span> <span class="p">{</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">kDefaultAuto</span> <span class="o">=</span> <span class="s">&quot;Default&quot;</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">kCustomAuto</span> <span class="o">=</span> <span class="s">&quot;My Auto&quot;</span><span class="p">;</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">m_autoSelected</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kd">final</span> <span class="n">SendableChooser</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">m_chooser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SendableChooser</span><span class="o">&lt;&gt;</span><span class="p">();</span>

  <span class="kd">private</span> <span class="n">VictorSP</span> <span class="n">m_Left0</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VictorSP</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="kd">private</span> <span class="n">VictorSP</span> <span class="n">m_Left1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VictorSP</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="kd">private</span> <span class="n">VictorSP</span> <span class="n">m_Right0</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VictorSP</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
  <span class="kd">private</span> <span class="n">VictorSP</span> <span class="n">m_Right1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VictorSP</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="kd">private</span> <span class="n">SpeedControllerGroup</span> <span class="n">m_LeftMotors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpeedControllerGroup</span><span class="p">(</span><span class="n">m_Left0</span><span class="p">,</span><span class="n">m_Left1</span><span class="p">);</span>
  <span class="kd">private</span> <span class="n">SpeedControllerGroup</span> <span class="n">m_RightMotors</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SpeedControllerGroup</span><span class="p">(</span><span class="n">m_Right0</span><span class="p">,</span><span class="n">m_Right1</span><span class="p">);</span>
  <span class="kd">private</span> <span class="n">DifferentialDrive</span> <span class="n">m_Drive</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DifferentialDrive</span><span class="p">(</span><span class="n">m_LeftMotors</span><span class="p">,</span><span class="n">m_RightMotors</span><span class="p">);</span>

  <span class="kd">private</span> <span class="n">XboxController</span> <span class="n">m_Controller</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XboxController</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

  <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">m_LimelightHasValidTarget</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">double</span> <span class="n">m_LimelightDriveCommand</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">double</span> <span class="n">m_LimelightSteerCommand</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

  <span class="cm">/**</span>
<span class="cm">   * This function is run when the robot is first started up and should be</span>
<span class="cm">   * used for any initialization code.</span>
<span class="cm">   */</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">robotInit</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">m_chooser</span><span class="p">.</span><span class="na">setDefaultOption</span><span class="p">(</span><span class="s">&quot;Default Auto&quot;</span><span class="p">,</span> <span class="n">kDefaultAuto</span><span class="p">);</span>
        <span class="n">m_chooser</span><span class="p">.</span><span class="na">addOption</span><span class="p">(</span><span class="s">&quot;My Auto&quot;</span><span class="p">,</span> <span class="n">kCustomAuto</span><span class="p">);</span>
        <span class="n">SmartDashboard</span><span class="p">.</span><span class="na">putData</span><span class="p">(</span><span class="s">&quot;Auto choices&quot;</span><span class="p">,</span> <span class="n">m_chooser</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * This function is called every robot packet, no matter the mode. Use</span>
<span class="cm">   * this for items like diagnostics that you want ran during disabled,</span>
<span class="cm">   * autonomous, teleoperated and test.</span>
<span class="cm">   *</span>
<span class="cm">   * &lt;p&gt;This runs after the mode specific periodic functions, but before</span>
<span class="cm">   * LiveWindow and SmartDashboard integrated updating.</span>
<span class="cm">   */</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">robotPeriodic</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * This autonomous (along with the chooser code above) shows how to select</span>
<span class="cm">   * between different autonomous modes using the dashboard. The sendable</span>
<span class="cm">   * chooser code works with the Java SmartDashboard. If you prefer the</span>
<span class="cm">   * LabVIEW Dashboard, remove all of the chooser code and uncomment the</span>
<span class="cm">   * getString line to get the auto name from the text box below the Gyro</span>
<span class="cm">   *</span>
<span class="cm">   * &lt;p&gt;You can add additional auto modes by adding additional comparisons to</span>
<span class="cm">   * the switch structure below with additional strings. If using the</span>
<span class="cm">   * SendableChooser make sure to add them to the chooser code above as well.</span>
<span class="cm">   */</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">autonomousInit</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">m_autoSelected</span> <span class="o">=</span> <span class="n">m_chooser</span><span class="p">.</span><span class="na">getSelected</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * This function is called periodically during autonomous.</span>
<span class="cm">   */</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">autonomousPeriodic</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * This function is called periodically during operator control.</span>
<span class="cm">   */</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">teleopPeriodic</span><span class="p">()</span> <span class="p">{</span>

        <span class="n">Update_Limelight_Tracking</span><span class="p">();</span>

        <span class="kt">double</span> <span class="n">steer</span> <span class="o">=</span> <span class="n">m_Controller</span><span class="p">.</span><span class="na">getX</span><span class="p">(</span><span class="n">Hand</span><span class="p">.</span><span class="na">kRight</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">drive</span> <span class="o">=</span> <span class="o">-</span><span class="n">m_Controller</span><span class="p">.</span><span class="na">getY</span><span class="p">(</span><span class="n">Hand</span><span class="p">.</span><span class="na">kLeft</span><span class="p">);</span>
        <span class="kt">boolean</span> <span class="n">auto</span> <span class="o">=</span> <span class="n">m_Controller</span><span class="p">.</span><span class="na">getAButton</span><span class="p">();</span>

        <span class="n">steer</span> <span class="o">*=</span> <span class="mf">0.70</span><span class="p">;</span>
        <span class="n">drive</span> <span class="o">*=</span> <span class="mf">0.70</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">auto</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">m_LimelightHasValidTarget</span><span class="p">)</span>
          <span class="p">{</span>
                <span class="n">m_Drive</span><span class="p">.</span><span class="na">arcadeDrive</span><span class="p">(</span><span class="n">m_LimelightDriveCommand</span><span class="p">,</span><span class="n">m_LimelightSteerCommand</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">else</span>
          <span class="p">{</span>
                <span class="n">m_Drive</span><span class="p">.</span><span class="na">arcadeDrive</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          <span class="n">m_Drive</span><span class="p">.</span><span class="na">arcadeDrive</span><span class="p">(</span><span class="n">drive</span><span class="p">,</span><span class="n">steer</span><span class="p">);</span>
        <span class="p">}</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPeriodic</span><span class="p">()</span> <span class="p">{</span>
  <span class="p">}</span>

  <span class="cm">/**</span>
<span class="cm">   * This function implements a simple method of generating driving and steering commands</span>
<span class="cm">   * based on the tracking data from a limelight camera.</span>
<span class="cm">   */</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">Update_Limelight_Tracking</span><span class="p">()</span>
  <span class="p">{</span>
        <span class="c1">// These numbers must be tuned for your Robot!  Be careful!</span>
        <span class="kd">final</span> <span class="kt">double</span> <span class="n">STEER_K</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">;</span>                    <span class="c1">// how hard to turn toward the target</span>
        <span class="kd">final</span> <span class="kt">double</span> <span class="n">DRIVE_K</span> <span class="o">=</span> <span class="mf">0.26</span><span class="p">;</span>                    <span class="c1">// how hard to drive fwd toward the target</span>
        <span class="kd">final</span> <span class="kt">double</span> <span class="n">DESIRED_TARGET_AREA</span> <span class="o">=</span> <span class="mf">13.0</span><span class="p">;</span>        <span class="c1">// Area of the target when the robot reaches the wall</span>
        <span class="kd">final</span> <span class="kt">double</span> <span class="n">MAX_DRIVE</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">;</span>                   <span class="c1">// Simple speed limit so we don&#39;t drive too fast</span>

        <span class="kt">double</span> <span class="n">tv</span> <span class="o">=</span> <span class="n">NetworkTableInstance</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">getTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">).</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;tv&quot;</span><span class="p">).</span><span class="na">getDouble</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">NetworkTableInstance</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">getTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">).</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;tx&quot;</span><span class="p">).</span><span class="na">getDouble</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">NetworkTableInstance</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">getTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">).</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;ty&quot;</span><span class="p">).</span><span class="na">getDouble</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">ta</span> <span class="o">=</span> <span class="n">NetworkTableInstance</span><span class="p">.</span><span class="na">getDefault</span><span class="p">().</span><span class="na">getTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">).</span><span class="na">getEntry</span><span class="p">(</span><span class="s">&quot;ta&quot;</span><span class="p">).</span><span class="na">getDouble</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">tv</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">m_LimelightHasValidTarget</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="n">m_LimelightDriveCommand</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
          <span class="n">m_LimelightSteerCommand</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">m_LimelightHasValidTarget</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="c1">// Start with proportional steering</span>
        <span class="kt">double</span> <span class="n">steer_cmd</span> <span class="o">=</span> <span class="n">tx</span> <span class="o">*</span> <span class="n">STEER_K</span><span class="p">;</span>
        <span class="n">m_LimelightSteerCommand</span> <span class="o">=</span> <span class="n">steer_cmd</span><span class="p">;</span>

        <span class="c1">// try to drive forward until the target area reaches our desired area</span>
        <span class="kt">double</span> <span class="n">drive_cmd</span> <span class="o">=</span> <span class="p">(</span><span class="n">DESIRED_TARGET_AREA</span> <span class="o">-</span> <span class="n">ta</span><span class="p">)</span> <span class="o">*</span> <span class="n">DRIVE_K</span><span class="p">;</span>

        <span class="c1">// don&#39;t let the robot drive too fast into the goal</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">drive_cmd</span> <span class="o">&gt;</span> <span class="n">MAX_DRIVE</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">drive_cmd</span> <span class="o">=</span> <span class="n">MAX_DRIVE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">m_LimelightDriveCommand</span> <span class="o">=</span> <span class="n">drive_cmd</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-1 docutils container">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#pragma once</span>

<span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&lt;frc/TimedRobot.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;frc/smartdashboard/SendableChooser.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;frc/VictorSP.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;frc/SpeedControllerGroup.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;frc/XboxController.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;frc/drive/DifferentialDrive.h&gt;</span><span class="cp"></span>


<span class="k">class</span> <span class="nc">Robot</span> <span class="o">:</span> <span class="k">public</span> <span class="n">frc</span><span class="o">::</span><span class="n">TimedRobot</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Robot</span><span class="p">();</span>

  <span class="kt">void</span> <span class="nf">RobotInit</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">RobotPeriodic</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">AutonomousInit</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">AutonomousPeriodic</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">TeleopInit</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">TeleopPeriodic</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">TestPeriodic</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>

  <span class="kt">void</span> <span class="nf">Update_Limelight_Tracking</span><span class="p">();</span>

 <span class="k">private</span><span class="o">:</span>
  <span class="n">frc</span><span class="o">::</span><span class="n">SendableChooser</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">m_chooser</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">kAutoNameDefault</span> <span class="o">=</span> <span class="s">&quot;Default&quot;</span><span class="p">;</span>
  <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">kAutoNameCustom</span> <span class="o">=</span> <span class="s">&quot;My Auto&quot;</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">m_autoSelected</span><span class="p">;</span>

  <span class="n">frc</span><span class="o">::</span><span class="n">VictorSP</span> <span class="n">m_Left0</span><span class="p">;</span>
  <span class="n">frc</span><span class="o">::</span><span class="n">VictorSP</span> <span class="n">m_Left1</span><span class="p">;</span>
  <span class="n">frc</span><span class="o">::</span><span class="n">VictorSP</span> <span class="n">m_Right0</span><span class="p">;</span>
  <span class="n">frc</span><span class="o">::</span><span class="n">VictorSP</span> <span class="n">m_Right1</span><span class="p">;</span>

  <span class="n">frc</span><span class="o">::</span><span class="n">SpeedControllerGroup</span> <span class="n">m_LeftMotors</span> <span class="p">{</span> <span class="n">m_Left0</span><span class="p">,</span><span class="n">m_Left1</span> <span class="p">};</span>
  <span class="n">frc</span><span class="o">::</span><span class="n">SpeedControllerGroup</span> <span class="n">m_RightMotors</span> <span class="p">{</span> <span class="n">m_Right0</span><span class="p">,</span><span class="n">m_Right1</span> <span class="p">};</span>
  <span class="n">frc</span><span class="o">::</span><span class="n">DifferentialDrive</span> <span class="n">m_Drive</span><span class="p">{</span> <span class="n">m_LeftMotors</span><span class="p">,</span> <span class="n">m_RightMotors</span> <span class="p">};</span>
  <span class="n">frc</span><span class="o">::</span><span class="n">XboxController</span> <span class="n">m_Controller</span><span class="p">;</span>

  <span class="kt">bool</span> <span class="n">m_LimelightHasTarget</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">m_LimelightTurnCmd</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">m_LimelightDriveCmd</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-2 docutils container">
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;Robot.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;frc/smartdashboard/SmartDashboard.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;networktables/NetworkTable.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;networktables/NetworkTableInstance.h&gt;</span><span class="cp"></span>


<span class="kt">double</span> <span class="nf">clamp</span><span class="p">(</span><span class="kt">double</span> <span class="n">in</span><span class="p">,</span><span class="kt">double</span> <span class="n">minval</span><span class="p">,</span><span class="kt">double</span> <span class="n">maxval</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">in</span> <span class="o">&gt;</span> <span class="n">maxval</span><span class="p">)</span> <span class="k">return</span> <span class="n">maxval</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">in</span> <span class="o">&lt;</span> <span class="n">minval</span><span class="p">)</span> <span class="k">return</span> <span class="n">minval</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">in</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">Robot</span><span class="o">::</span><span class="n">Robot</span><span class="p">()</span> <span class="o">:</span>
  <span class="n">m_Left0</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
  <span class="n">m_Left1</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
  <span class="n">m_Right0</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
  <span class="n">m_Right1</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
  <span class="n">m_Controller</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">m_LeftMotors</span><span class="p">.</span><span class="n">SetInverted</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
  <span class="n">m_RightMotors</span><span class="p">.</span><span class="n">SetInverted</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">Robot</span><span class="o">::</span><span class="n">RobotInit</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">m_chooser</span><span class="p">.</span><span class="n">SetDefaultOption</span><span class="p">(</span><span class="n">kAutoNameDefault</span><span class="p">,</span> <span class="n">kAutoNameDefault</span><span class="p">);</span>
  <span class="n">m_chooser</span><span class="p">.</span><span class="n">AddOption</span><span class="p">(</span><span class="n">kAutoNameCustom</span><span class="p">,</span> <span class="n">kAutoNameCustom</span><span class="p">);</span>
  <span class="n">frc</span><span class="o">::</span><span class="n">SmartDashboard</span><span class="o">::</span><span class="n">PutData</span><span class="p">(</span><span class="s">&quot;Auto Modes&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m_chooser</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Robot</span><span class="o">::</span><span class="n">RobotPeriodic</span><span class="p">()</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="n">Robot</span><span class="o">::</span><span class="n">AutonomousInit</span><span class="p">()</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="n">Robot</span><span class="o">::</span><span class="n">AutonomousPeriodic</span><span class="p">()</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="n">Robot</span><span class="o">::</span><span class="n">TeleopInit</span><span class="p">()</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="n">Robot</span><span class="o">::</span><span class="n">TeleopPeriodic</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Update_Limelight_Tracking</span><span class="p">();</span>

  <span class="kt">bool</span> <span class="n">do_limelight</span> <span class="o">=</span> <span class="n">m_Controller</span><span class="p">.</span><span class="n">GetAButton</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">do_limelight</span><span class="p">)</span>
  <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m_LimelightHasTarget</span><span class="p">)</span>
        <span class="p">{</span>
          <span class="n">m_Drive</span><span class="p">.</span><span class="n">ArcadeDrive</span><span class="p">(</span><span class="n">m_LimelightDriveCmd</span><span class="p">,</span><span class="n">m_LimelightTurnCmd</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
          <span class="n">m_Drive</span><span class="p">.</span><span class="n">ArcadeDrive</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
        <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
        <span class="c1">// Tank Drive</span>
        <span class="c1">//double left = -m_Controller.GetY(frc::GenericHID::JoystickHand::kLeftHand);</span>
        <span class="c1">//double right = -m_Controller.GetY(frc::GenericHID::JoystickHand::kRightHand);</span>
        <span class="c1">//m_Drive.TankDrive(left,right);</span>

        <span class="c1">// Arcade Drive</span>
        <span class="kt">double</span> <span class="n">fwd</span> <span class="o">=</span> <span class="o">-</span><span class="n">m_Controller</span><span class="p">.</span><span class="n">GetY</span><span class="p">(</span><span class="n">frc</span><span class="o">::</span><span class="n">GenericHID</span><span class="o">::</span><span class="n">JoystickHand</span><span class="o">::</span><span class="n">kLeftHand</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">turn</span> <span class="o">=</span> <span class="n">m_Controller</span><span class="p">.</span><span class="n">GetX</span><span class="p">(</span><span class="n">frc</span><span class="o">::</span><span class="n">GenericHID</span><span class="o">::</span><span class="n">JoystickHand</span><span class="o">::</span><span class="n">kRightHand</span><span class="p">);</span>
        <span class="n">fwd</span> <span class="o">*=</span> <span class="mf">0.7f</span><span class="p">;</span>
        <span class="n">turn</span> <span class="o">*=</span> <span class="mf">0.7f</span><span class="p">;</span>
        <span class="n">m_Drive</span><span class="p">.</span><span class="n">ArcadeDrive</span><span class="p">(</span><span class="n">fwd</span><span class="p">,</span><span class="n">turn</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Robot</span><span class="o">::</span><span class="n">TestPeriodic</span><span class="p">()</span> <span class="p">{}</span>

<span class="kt">void</span> <span class="n">Robot</span><span class="o">::</span><span class="n">Update_Limelight_Tracking</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// Proportional Steering Constant:</span>
  <span class="c1">// If your robot doesn&#39;t turn fast enough toward the target, make this number bigger</span>
  <span class="c1">// If your robot oscillates (swings back and forth past the target) make this smaller</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">STEER_K</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">;</span>

  <span class="c1">// Proportional Drive constant: bigger = faster drive</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">DRIVE_K</span> <span class="o">=</span> <span class="mf">0.26</span><span class="p">;</span>

  <span class="c1">// Area of the target when your robot has reached the goal</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">DESIRED_TARGET_AREA</span> <span class="o">=</span> <span class="mf">13.0</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">MAX_DRIVE</span> <span class="o">=</span> <span class="mf">0.65</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">MAX_STEER</span> <span class="o">=</span> <span class="mf">1.0f</span><span class="p">;</span>

  <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">NetworkTable</span><span class="o">&gt;</span> <span class="n">table</span> <span class="o">=</span> <span class="n">nt</span><span class="o">::</span><span class="n">NetworkTableInstance</span><span class="o">::</span><span class="n">GetDefault</span><span class="p">().</span><span class="n">GetTable</span><span class="p">(</span><span class="s">&quot;limelight&quot;</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;tx&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">ty</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ty&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">ta</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;ta&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>
  <span class="kt">double</span> <span class="n">tv</span> <span class="o">=</span> <span class="n">table</span><span class="o">-&gt;</span><span class="n">GetNumber</span><span class="p">(</span><span class="s">&quot;tv&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">tv</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
  <span class="p">{</span>
        <span class="n">m_LimelightHasTarget</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">m_LimelightDriveCmd</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
        <span class="n">m_LimelightTurnCmd</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
        <span class="n">m_LimelightHasTarget</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

        <span class="c1">// Proportional steering</span>
        <span class="n">m_LimelightTurnCmd</span> <span class="o">=</span> <span class="n">tx</span><span class="o">*</span><span class="n">STEER_K</span><span class="p">;</span>
        <span class="n">m_LimelightTurnCmd</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">m_LimelightTurnCmd</span><span class="p">,</span><span class="o">-</span><span class="n">MAX_STEER</span><span class="p">,</span><span class="n">MAX_STEER</span><span class="p">);</span>

        <span class="c1">// drive forward until the target area reaches our desired area</span>
        <span class="n">m_LimelightDriveCmd</span> <span class="o">=</span> <span class="p">(</span><span class="n">DESIRED_TARGET_AREA</span> <span class="o">-</span> <span class="n">ta</span><span class="p">)</span> <span class="o">*</span> <span class="n">DRIVE_K</span><span class="p">;</span>
        <span class="n">m_LimelightDriveCmd</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">(</span><span class="n">m_LimelightDriveCmd</span><span class="p">,</span><span class="o">-</span><span class="n">MAX_DRIVE</span><span class="p">,</span><span class="n">MAX_DRIVE</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="cp">#ifndef RUNNING_FRC_TESTS</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">frc</span><span class="o">::</span><span class="n">StartRobot</span><span class="o">&lt;</span><span class="n">Robot</span><span class="o">&gt;</span><span class="p">();</span> <span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
<div class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-0-3 docutils container">
<p>Here is a block diagram for a LabView VI which reads tracking data from a Limelight and generates drive and steer commands.  This image is a “LabView Snippet”.  Just save the image file to your computer and then drag it into a labview VI and the block diagram will be reproduced.</p>
<img alt="_images/Labview_Tank_VI.png" src="_images/Labview_Tank_VI.png" />
<p>You can also download the entire labview source code from this link:</p>
<p>&lt;<a class="reference external" href="https://www.mediafire.com/file/f35w3wllbmj9yt7/DeepSpaceLabviewExample.zip/file/">https://www.mediafire.com/file/f35w3wllbmj9yt7/DeepSpaceLabviewExample.zip/file/</a>&gt;`_</p>
</div>
</div>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-python_software"></span><div class="section" id="using-python-to-create-custom-opencv-vision-pipelines">
<h2>Using Python to create Custom OpenCV Vision Pipelines<a class="headerlink" href="#using-python-to-create-custom-opencv-vision-pipelines" title="Permalink to this headline">¶</a></h2>
<p>Limelight has successfully exposed a large number of students to some of the capabilities of computer vision in robotics. With python scripting, teams can now take another step forward by writing their own image processing pipelines.</p>
<a class="reference internal image-reference" href="https://thumbs.gfycat.com/SpotlessGlisteningCygnet-size_restricted.gif"><img alt="https://thumbs.gfycat.com/SpotlessGlisteningCygnet-size_restricted.gif" class="align-center" src="https://thumbs.gfycat.com/SpotlessGlisteningCygnet-size_restricted.gif" style="width: 100%;" /></a>
<dl class="docutils">
<dt>Limelight handles the hardware, camera interfacing, networking, streaming, and basic image pre-processing. All you need to do is write one python function called runPipeline().</dt>
<dd><ul class="first last simple">
<li>One of the most important features we offer is the one-click crosshair. The crosshair, dual crosshair, tx, ty, ta, ts, tvert, and all other standard limelight NetworkTables readings will automatically latch to the contour you return from the python runPipeline() function.</li>
<li><dl class="first docutils">
<dt>Write your own real-time visualizations, thresholding, filtering, and bypass our backend entirely if desired.</dt>
<dd><ul class="first last">
<li>Limelight’s python scripting has access to the full OpenCV and numpy libraries.</li>
<li>Beyond access to the image, the runPipeline() function also has access to the “llrobot” NetworkTables number array. Send any data from your robots to your python scripts for visualization or advanced applications (One might send IMU data, pose data, robot velocity, etc. for use in python scripts)</li>
<li>The runPipeline function also outputs a number array that is placed directly into the “llpython” networktables number array. This means you can bypass Limelight’s crosshair and other functionality entirely and send your own custom data back to your robots.</li>
<li>Python scripts are sandboxed within our c++ environment, so you don’t have to worry about crashes. Changes to scripts are applied instantly, and any error messages are printed directly to the web interface.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<div class="section" id="minimal-limelight-python-script">
<h3>Minimal Limelight Python Script<a class="headerlink" href="#minimal-limelight-python-script" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># runPipeline() is called every frame by Limelight&#39;s backend.</span>
<span class="k">def</span> <span class="nf">runPipeline</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">llrobot</span><span class="p">):</span>
    <span class="c1"># convert the input image to the HSV color space</span>
    <span class="n">img_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2HSV</span><span class="p">)</span>
    <span class="c1"># convert the hsv to a binary image by removing any pixels</span>
    <span class="c1"># that do not fall within the following HSV Min/Max values</span>
    <span class="n">img_threshold</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">inRange</span><span class="p">(</span><span class="n">img_hsv</span><span class="p">,</span> <span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span> <span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>

    <span class="c1"># find contours in the new binary image</span>
    <span class="n">contours</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findContours</span><span class="p">(</span><span class="n">img_threshold</span><span class="p">,</span>
    <span class="n">cv2</span><span class="o">.</span><span class="n">RETR_EXTERNAL</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">CHAIN_APPROX_SIMPLE</span><span class="p">)</span>

    <span class="n">largestContour</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[]])</span>

    <span class="c1"># initialize an empty array of values to send back to the robot</span>
    <span class="n">llpython</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># if contours have been detected, draw them</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contours</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">contours</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># record the largest contour</span>
        <span class="n">largestContour</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">)</span>

        <span class="c1"># get the unrotated bounding box that surrounds the contour</span>
        <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">largestContour</span><span class="p">)</span>

        <span class="c1"># draw the unrotated bounding box</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image</span><span class="p">,(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># record some custom data to send back to the robot</span>
        <span class="n">llpython</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>

    <span class="c1">#return the largest contour for the LL crosshair, the modified image, and custom robot data</span>
    <span class="k">return</span> <span class="n">largestContour</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">llpython</span>
</pre></div>
</div>
</div>
</div>
<span id="document-python_examples"></span><div class="section" id="python-examples">
<h2>Python Examples<a class="headerlink" href="#python-examples" title="Permalink to this headline">¶</a></h2>
<p>WIP</p>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-grip_software"></span><div class="section" id="using-grip-to-create-custom-opencv-vision-pipelines">
<h2>Using Grip to create Custom OpenCV Vision Pipelines<a class="headerlink" href="#using-grip-to-create-custom-opencv-vision-pipelines" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>You can use GRIP to grapically design custom vision pipelines.</li>
<li>Your custom vision pipeline can be loaded into a limelight and run in hardware.</li>
</ol>
<p>Grip is a program developed by WPI for developing vision pipelines.  We have added a new export option to grip which allows you to export your custom vision pipeline and run it on a limelight camera with no extra programming needed.  Carefully designed Grip pipelines can run at the full 90fps framerate of the limelight camera.</p>
<p>The first step in using GRIP is to download our build of Grip.  It can be downloaded from our <a class="reference external" href="https://limelightvision.io/pages/downloads">downloads page</a>.  When you run GRIP, you should see a screen like this:</p>
<img alt="_images/Grip.jpg" src="_images/Grip.jpg" />
<p>You can learn more about GRIP on this web page:
<a class="reference external" href="https://docs.wpilib.org/en/stable/docs/software/vision-processing/grip/introduction-to-grip.html">https://docs.wpilib.org/en/stable/docs/software/vision-processing/grip/introduction-to-grip.html</a></p>
<div class="section" id="accessing-the-video-stream-wthin-grip">
<h3>Accessing the Video Stream wthin GRIP<a class="headerlink" href="#accessing-the-video-stream-wthin-grip" title="Permalink to this headline">¶</a></h3>
<p>Limelight has an additional video stream on port 5802 which can be accessed primarily for use with GRIP or other applications like it.  This video stream is uncompressed (or very lightly compressed) and has no cross-hair or other overlays drawn on the image.  It is important to use this video stream for developing your GRIP pipeline because the normal Limelight video feed is optimized for very low bandwidth and latency which causes the image to be relatively low quality and can have significant compression artefacts.  So to get your grip pipeline started, add an IP Camera input which uses the limelight as its input:</p>
<img alt="_images/Grip_Add_IPCamera.jpg" src="_images/Grip_Add_IPCamera.jpg" />
</div>
<div class="section" id="how-limelight-handles-inputs-to-the-pipeline">
<h3>How Limelight Handles Inputs to the Pipeline<a class="headerlink" href="#how-limelight-handles-inputs-to-the-pipeline" title="Permalink to this headline">¶</a></h3>
<p>It is important to understand how your limelight camera interfaces with the inputs to your vision pipeline.  Once your pipeline is loaded into the limelight camera, its inputs will be scanned.  The first input is always assumed to be the video feed from the camera so it is important that you structure your pipeline in this way.  Any additional inputs to the pipeline will recieve upload buttons in the limelight UI which will allow you to upload addtional images or data files as needed by your pipeline.  For now it is important to realize that the video stream should be the first input in your Grip Pipeline.</p>
</div>
<div class="section" id="generating-output-for-the-limelight-to-use">
<h3>Generating output for the Limelight to use<a class="headerlink" href="#generating-output-for-the-limelight-to-use" title="Permalink to this headline">¶</a></h3>
<p>When your grip pipeline is loaded onto the limelight, it will also be scanned for output data in the form of contours, blobs, or rectangles.  If any of these outputs are found, the last one in the pipeline will be used as the ‘results’ of your vision pipeline.  The outputs of your pipeline will be passed through the built-in contour filtering system on the limelight.  If you want to do your own contour filtering within your GRIP pipeline, just set the limelight options to essentially accept any contour.  In the example shown below, the output of the block highlighted in red would be passed on to the limelight targetting system.  Notice that this example pipline produces contours at an intermediate step and then filters them.  Only the final set of contours (or blobs or rectangles) will be passed on to the limelight targetting system.</p>
<img alt="_images/Grip_SimplePipeline.jpg" src="_images/Grip_SimplePipeline.jpg" />
</div>
<div class="section" id="code-generation-for-limelight">
<h3>Code Generation for Limelight<a class="headerlink" href="#code-generation-for-limelight" title="Permalink to this headline">¶</a></h3>
<p>When you are ready to try running your pipeline in hardware on the limelight, it is time to use the code-generation function of GRIP.  We have added a new “Limelight” code generation target to the GRIP application.  Using this option will produce a &lt;pipeline&gt;.ll file which can be loaded into the limelight camera.</p>
<img alt="_images/Grip_CodeGeneration.jpg" src="_images/Grip_CodeGeneration.jpg" />
</div>
</div>
<span id="document-grip_limelight"></span><div class="section" id="running-grip-pipelines-on-limelight">
<h2>Running GRIP Pipelines on Limelight<a class="headerlink" href="#running-grip-pipelines-on-limelight" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Upload your custom GRIP pipeline into a limelight pipeline.</li>
<li>Upload any additional inputs to your pipeline.</li>
<li>Observe the behavior of your GRIP pipeline.</li>
</ol>
<p>Once you have used GRIP to design a custom vision pipeline and exported your pipeline to a .LL file, it is time to run it on the limelight camera hardware.  The first step is to select which limelight pipeline you’d like to load your grip pipeline into.  In order to do this, you use the UI at the top of the limelight interface to select a pipeline.  Normally your robot (through network-tables) controls the currently active pipeline.  Our first step is to disable that functionality so that we can select the pipeline to edit:</p>
<img alt="_images/GRIP_SelectingPipeline0.png" src="_images/GRIP_SelectingPipeline0.png" />
<p>Next, change the currently active pipeline using the dropdown box highlighted below.</p>
<img alt="_images/GRIP_SelectingPipeline1.png" src="_images/GRIP_SelectingPipeline1.png" />
<p>Next use the ‘Upload’ button to load your .LL file into this limelight pipeline.</p>
<img alt="_images/GRIP_PipelineUpload.png" src="_images/GRIP_PipelineUpload.png" />
<p>And finally, change the pipeline mode from “LimeLight Standard” to “GRIP”.</p>
<img alt="_images/GRIP_PipelineModeSelection.png" src="_images/GRIP_PipelineModeSelection.png" />
<p>Once you have loaded a Grip pipeline, the UI changes slightly.  In place of the ‘Thresholding’ tab, you will have a ‘GRIP’ tab.  If your GRIP pipeline uses more than just the video feed as an input, you will have a list of additional inputs as shown below with upload buttons for uploading images or other data into them.</p>
<img alt="_images/GRIP_GripTab.png" src="_images/GRIP_GripTab.png" />
<p>In addition, the video feed will have new options for displaying any intermediate images generated by your GRIP pipeline.</p>
<img alt="_images/GRIP_VideoFeedOptions.png" src="_images/GRIP_VideoFeedOptions.png" />
<p>When you are using a GRIP pipeline, the settings on the Input, ContourFiltering, and Output tabs are still fully functional.  If you would prefer to do your contour filtering within GRIP, you can simply “open up” all of the limelight contour filtering options to allow all contours to pass through.</p>
</div>
</div>
<div class="toctree-wrapper compound">
<span id="document-frequently_asked_questions"></span><div class="section" id="frequently-asked-questions">
<h2>Frequently Asked Questions<a class="headerlink" href="#frequently-asked-questions" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-is-limelight-using-a-low-320x240-resolution">
<h3>Why is limelight using a low (320x240) resolution?<a class="headerlink" href="#why-is-limelight-using-a-low-320x240-resolution" title="Permalink to this headline">¶</a></h3>
<p>Using a lower resolution allows us to run the vision pipeline at a high framrate.  Limelight provides tracking data fast enough to use its outputs to directly drive a PID loop on your robot.  This makes integrating vision into your robot extremely simple; limelight is just another sensor!  Additionally, we have used even lower resolutions for the past two years in FRC.  In our final event (China), our 2016 robot never mis-aimed a shot while using 160x120 resolution and aiming at one of the most difficult targets FRC has used to-date (the high goal in stronghold).  <em>All</em> of its shots were auto-aimed; it was impossible to manually aim that robot.</p>
</div>
<div class="section" id="what-if-the-game-calls-for-a-different-tracking-algorithm">
<h3>What if the game calls for a different tracking algorithm?<a class="headerlink" href="#what-if-the-game-calls-for-a-different-tracking-algorithm" title="Permalink to this headline">¶</a></h3>
<p>We believe that Limelight will give you the tools to solve the vision tracking challenge for any FRC game.  However if some challenge comes up which we have not anticipated, we will add the features needed for you to track the new type of target.</p>
</div>
<div class="section" id="why-is-there-an-extra-usb-port">
<h3>Why is there an extra usb port?<a class="headerlink" href="#why-is-there-an-extra-usb-port" title="Permalink to this headline">¶</a></h3>
<p>You can add a usb camera to limelight to act as a secondary driver or backup camera. The second camera stream will automatically appear alongside the primary camera stream.  Limelight’s video stream uses very little bandwidth so you can safely use this feature for a competitive advantage.</p>
</div>
<div class="section" id="how-do-i-view-the-video-stream">
<h3>How do I view the video stream?<a class="headerlink" href="#how-do-i-view-the-video-stream" title="Permalink to this headline">¶</a></h3>
<p>The video stream exists at <a class="reference external" href="http:/">http:/</a>/&lt;Limelight’s IP address or limelight.local&gt;:5800. Stream info is also posted to network tables so SmartDashbaord and Shuffleboard (test LV dashboard) will automatically find it.</p>
</div>
<div class="section" id="are-the-eight-leds-bright-enough">
<h3>Are the eight LEDs bright enough?<a class="headerlink" href="#are-the-eight-leds-bright-enough" title="Permalink to this headline">¶</a></h3>
<p>The total light output of the LEDs is 400 lumens, and the LED cones actually increase the illuminance (functional light) of the device. To compare, the common two-ring setup has a total output of roughly 250 lumens.</p>
</div>
<div class="section" id="does-limelight-support-protocols-other-than-networktables">
<h3>Does Limelight support protocols other than NetworkTables?<a class="headerlink" href="#does-limelight-support-protocols-other-than-networktables" title="Permalink to this headline">¶</a></h3>
<p>Limelight also streams tx, ty, ta, and ts over the Serial (UART) pins at the back of the enclosure.</p>
</div>
<div class="section" id="does-limelight-support-active-poe">
<h3>Does Limelight support Active PoE?<a class="headerlink" href="#does-limelight-support-active-poe" title="Permalink to this headline">¶</a></h3>
<p>Limelight only supports passive PoE.  Active POE requires a handshake between the sending and receiving POE devices.  Limelight is designed to work with a passive POE injector.  Just supply 12V by wiring the passive POE injector right into your PDP.</p>
</div>
<div class="section" id="should-i-plug-limelight-into-our-vrm-voltage-regulator-module">
<h3>Should I plug Limelight into our VRM (Voltage Regulator Module)?<a class="headerlink" href="#should-i-plug-limelight-into-our-vrm-voltage-regulator-module" title="Permalink to this headline">¶</a></h3>
<p>Limelight is designed to be connected to the main robot battery.  It contains its own voltage regulators.</p>
</div>
<div class="section" id="my-robot-has-extreme-voltage-swings-while-driving-will-this-damage-my-limelight">
<h3>My robot has extreme voltage swings while driving, will this damage my Limelight?<a class="headerlink" href="#my-robot-has-extreme-voltage-swings-while-driving-will-this-damage-my-limelight" title="Permalink to this headline">¶</a></h3>
<p>We specifically designed Limelight to handle the “noisy” power available on a typical FRC robot.  It contains the voltage regulators needed to generate the voltages it needs to operate as long its input voltage is above 6V.</p>
</div>
<div class="section" id="will-limelight-s-leds-dim-when-our-robot-s-voltage-drops">
<h3>Will Limelight’s LEDs dim when our robot’s voltage drops?<a class="headerlink" href="#will-limelight-s-leds-dim-when-our-robot-s-voltage-drops" title="Permalink to this headline">¶</a></h3>
<p>We designed the LED array on Limelight to produce a consistent brightness all the way down to 7.5V.  So your tracking should remain consistent even when your robot motors are putting a heavy load on the battery.  This can be an important feature for robots with high-traction drivetrains that aim by turning in place.</p>
</div>
</div>
<span id="document-additional_resources"></span><div class="section" id="additional-resources">
<h2>Additional Resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">¶</a></h2>
<div class="section" id="team-254-vision-talk">
<h3>Team 254 Vision Talk<a class="headerlink" href="#team-254-vision-talk" title="Permalink to this headline">¶</a></h3>
<p>Team 254 gave an this excellent talk on how to do vision tracking using an android phone! Their talk is packed with very good information on the theory and implementation of vision tracking.
<a class="reference external" href="https://www.youtube.com/watch?v=rLwOkAJqImo">https://www.youtube.com/watch?v=rLwOkAJqImo</a></p>
</div>
<div class="section" id="wpi-vision-processing-resources">
<h3>WPI Vision Processing Resources<a class="headerlink" href="#wpi-vision-processing-resources" title="Permalink to this headline">¶</a></h3>
<p>These pages are loaded with information on various ways to implement your own vision processing pipeline.
<a class="reference external" href="https://docs.wpilib.org/en/stable/docs/software/vision-processing/index.html">https://docs.wpilib.org/en/stable/docs/software/vision-processing/index.html</a></p>
</div>
<div class="section" id="grip">
<h3>GRIP<a class="headerlink" href="#grip" title="Permalink to this headline">¶</a></h3>
<p>Grip is a tool that lets you build OpenCV pipelines using a drag-and-drop GUI.
<a class="reference external" href="https://docs.wpilib.org/en/stable/docs/software/vision-processing/grip/introduction-to-grip.html">https://docs.wpilib.org/en/stable/docs/software/vision-processing/grip/introduction-to-grip.html</a></p>
</div>
</div>
<span id="document-software_change_log"></span><div class="section" id="software-change-log">
<h2>Software Change Log<a class="headerlink" href="#software-change-log" title="Permalink to this headline">¶</a></h2>
<p>Contact us or post to CD to suggest upgrades for Limelight!</p>
<div class="section" id="id1">
<h3>2022.2.3 (3/16/22)<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Bugfixes and robot-code crop filtering.</p>
<div class="section" id="bugfixes">
<h4>Bugfixes<a class="headerlink" href="#bugfixes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix “stream” networktables key and Picture-In-Picture Modes</li>
<li>Fix “snapshot” networktables key. Users must set the “snapshot” key to “0” before setting it to “1” to take a screenshot.</li>
<li>Remove superfluous python-related alerts from web interface</li>
</ul>
</div>
<div class="section" id="features-and-changes">
<h4>Features and Changes<a class="headerlink" href="#features-and-changes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><dl class="first docutils">
<dt>Manual Crop Filtering</dt>
<dd><ul class="first last">
<li>Using the “crop” networktables array, teams can now control crop rectangles from robot code.</li>
<li>For the “crop” key to work, the current pipeline must utilize the default, wide-open crop rectangle (-1 for minX and minY, +1 for maxX and +1 maxY).</li>
<li>In addition, the “crop” networktable array must have exactly 4 values, and at least one of those values must be non-zero.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="id2">
<h3>2022.2.2 (2/23/22)<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Mandatory upgrade for all teams based on Week 0 and FMS reliability testing.</p>
<div class="section" id="id3">
<h4>Bugfixes<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix hang / loss of connection / loss of targeting related to open web interfaces, FMS, FMS-like setups, Multiple viewer devices etc.</li>
</ul>
</div>
<div class="section" id="id4">
<h4>Features and Changes<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<ul>
<li><dl class="first docutils">
<dt>Crop Filtering</dt>
<dd><ul class="first last">
<li><p class="first">Ignore all pixels outside of a specified crop rectangle</p>
</li>
<li><p class="first">If your flywheel has any sweet spots on the field, you can make use of the crop filter to ignore the vast majority of pixels in specific pipelines. This feature should help teams reduce the probability of tracking non-targets.</p>
</li>
<li><p class="first">If you are tracking cargo, use this feature to look for cargo only within a specific part of the image. Consider ignoring your team’s bumpers, far-away targets, etc.</p>
</li>
<li><img alt="https://thumbs.gfycat.com/ChillyWhimsicalGander-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/ChillyWhimsicalGander-size_restricted.gif" />
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Corners feature now compatible with smart target grouping</dt>
<dd><ul class="first last">
<li><p class="first">This one is for the teams that want to do more advanced custom vision on the RIO</p>
</li>
<li><p class="first">“tcornxy” corner limit increased to 64 corners</p>
</li>
<li><p class="first">Contour simplification and force convex features now work properly with smart target grouping and corner sending</p>
</li>
<li><img alt="https://thumbs.gfycat.com/DaringTatteredBlowfish-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/DaringTatteredBlowfish-size_restricted.gif" />
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">IQR Filter max increased to 3.0</p>
</li>
<li><p class="first">Web interface live target update rate reduced from 30fps to 15fps to reduce bandwidth and cpu load while the web interface is open</p>
</li>
</ul>
</div>
</div>
<div class="section" id="id5">
<h3>2022.1 (1/25/22)<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id6">
<h4>Bugfixes<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>We acquired information from one of our suppliers about an issue (and a fix!) that affects roughly 1/75 of the CPUs specifically used in Limelight 2 (it may be related to a specific batch). It makes sense, and it was one of the only remaining boot differences between the 2022 image and the 2020 image.</li>
<li>Fix the upload buttons for GRIP inputs and SolvePNP Models</li>
</ul>
</div>
<div class="section" id="features">
<h4>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h4>
<ul>
<li><dl class="first docutils">
<dt>Hue Rainbow</dt>
<dd><ul class="first last">
<li><p class="first">The new hue rainbow makes it easier to configure the hue threshold. Here’s an example of filtering for blue pixels:</p>
</li>
<li><img alt="https://thumbs.gfycat.com/BoldDishonestAntarcticgiantpetrel-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/BoldDishonestAntarcticgiantpetrel-size_restricted.gif" />
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Hue Inversion</dt>
<dd><ul class="first last">
<li><p class="first">The new hue inversion feature is a critical feature if you want to track red objects, as red is at both the beginning and the end of the hue range:</p>
</li>
<li><p class="first">If you’re trying to track cargo, the aspect ratio filter (set a tight range around “1”) and the fullness filter (you want above 70%) should work quite well. Explicit “circle” filtering is relatively slow and wont work as well as people assume.</p>
</li>
<li><img alt="https://thumbs.gfycat.com/MeekSnarlingFluke-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/MeekSnarlingFluke-size_restricted.gif" />
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New Python Libraries</dt>
<dd><ul class="first last simple">
<li>Added scipy, scikit-image, pywavelets, pillow, and pyserial to our python sandbox.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
</div>
<div class="section" id="and-2022-0-3-1-15-22">
<h3>2022.0 and 2022.0.3 (1/15/22)<a class="headerlink" href="#and-2022-0-3-1-15-22" title="Permalink to this headline">¶</a></h3>
<p>This is a big one. Here are the four primary changes:</p>
<div class="section" id="id7">
<h4>Features<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<ul>
<li><dl class="first docutils">
<dt>Smart Target Grouping</dt>
<dd><ul class="first last">
<li><p class="first">Automatically group targets that pass all individual target filters.</p>
</li>
<li><p class="first">Will dynamically group any number of targets between -group size slider minimum- and -group size slider maximum-</p>
</li>
<li><img alt="https://thumbs.gfycat.com/WetImmediateEarthworm-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/WetImmediateEarthworm-size_restricted.gif" />
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Outlier Rejection</dt>
<dd><ul class="first last">
<li><p class="first">While this goal is more challenging than other goals, it gives us more opportunities for filtering. Conceptually, this goal is more than a “green blob.” Since we know that the goal is comprised of multiple targets that are close to each other, we can actually reject outlier targets that stand on their own.</p>
</li>
<li><p class="first">You should rely almost entirely on good target filtering for this year’s goal, and only use outlier rejection if you see or expect spurious outliers in your camera stream. If you have poor standard target filtering, outlier detection could begin to work against you!</p>
</li>
<li><img alt="https://thumbs.gfycat.com/CoolQualifiedHedgehog-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/CoolQualifiedHedgehog-size_restricted.gif" />
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Limelight 2022 Image Upgrades</dt>
<dd><p class="first">We have removed hundreds of moving parts from our software. These are the results:</p>
<ul class="last simple">
<li>Compressed Image Size: 1.3 GB in 2020 → 76MB for 2022 (Reduced by a factor of 17!)</li>
<li>Download time: 10s of minutes in 2020 → seconds for 2022</li>
<li>Flash time: 5+ minutes in 2020 → seconds for 2022</li>
<li>Boot time: 35+ seconds in 2020 → 14 seconds for 2022 (10 seconds to LEDS on)</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Full Python Scripting</dt>
<dd><p class="first">Limelight has successfully exposed a large number of students to some of the capabilities of computer vision in robotics. With python scripting, teams can now take another step forward by writing their own image processing pipelines.</p>
<blockquote>
<div><ul>
<li><img alt="https://thumbs.gfycat.com/SpotlessGlisteningCygnet-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/SpotlessGlisteningCygnet-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
<ul class="last simple">
<li>Limelight handles the hardware, camera interfacing, networking, streaming, and basic image pre-processing. All you need to do is write one python function called runPipeline().</li>
<li>One of the most important features we offer is the one-click crosshair. The crosshair, dual crosshair, tx, ty, ta, ts, tvert, and all other standard limelight NetworkTables readings will automatically latch to the contour you return from the python runPipeline() function.</li>
<li><dl class="first docutils">
<dt>Write your own real-time visualizations, thresholding, filtering, and bypass our backend entirely if desired.</dt>
<dd><ul class="first last">
<li>Limelight’s python scripting has access to the full OpenCV and numpy libraries.</li>
<li>Beyond access to the image, the runPipeline() function also has access to the “llrobot” NetworkTables number array. Send any data from your robots to your python scripts for visualization or advanced applications (One might send IMU data, pose data, robot velocity, etc. for use in python scripts)</li>
<li>The runPipeline function also outputs a number array that is placed directly into the “llpython” networktables number array. This means you can bypass Limelight’s crosshair and other functionality entirely and send your own custom data back to your robots.</li>
<li>Python scripts are sandboxed within our c++ environment, so you don’t have to worry about crashes. Changes to scripts are applied instantly, and any error messages are printed directly to the web interface.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">This update is compatible with all Limelight Hardware, including Limelight 1.</p>
</li>
<li><p class="first">Known issues: Using hardware zoom with python will produce unexpected results.</p>
</li>
<li><p class="first">2022.0.3 restores the 5802 GRIP stream, and addresses boot issues on some LL2 units by reverting some of the boot time optimizations. Boot time is increased to 16 seconds.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="id8">
<h3>2020.4  (3/11/20)<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>2020.4 is another critical update that eliminates the intermittent 2-4 second crash that could occur during an abrupt mjpeg stream disconnection. This often happened at the very end of the match, and in some cases could happen during matches.</p>
</div>
<div class="section" id="id9">
<h3>2020.3  (2/25/20)<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>2020.3 is a critical update that addresses intermittent networking-related software restarts, and addresses a crash that would occur upon USB camera disconnection.</p>
</div>
<div class="section" id="id10">
<h3>2020.2  (1/30/20)<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>2020.2 pushes Limelight’s hardware even further by adding the ability to pan and zoom to any point. It also adds a brand new video mode and important bug fixes.  Let us know what features you would like to see in future updates!</p>
<div class="section" id="id11">
<h4>Features<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">3x Hardware Zoom at 60 FPS</p>
<blockquote>
<div><ul>
<li><p class="first">Our last update added 2x Hardware Zoom for all Limelight models at no cost whatsoever. We’ve managed to push our hardware zoom even further with 3x Hardware Zoom. All Limelight models are now capable of 3x Hardware Zoom at 60fps. This makes full-court tracking even easier for every team.</p>
</li>
<li><p class="first">The following gif shows 1x, 2x, and 3x Hardware Zoom from the sector line (full court shot line):</p>
</li>
<li><img alt="https://thumbs.gfycat.com/UnitedAntiqueKestrel-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/UnitedAntiqueKestrel-size_restricted.gif" />
</li>
<li><p class="first">This gif shows only 1x and 3x Hardware Zoom from the full-court sector line shot location:</p>
</li>
<li><img alt="https://thumbs.gfycat.com/HeftySimpleAnemone-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/HeftySimpleAnemone-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Hardware Panning</p>
<blockquote>
<div><ul>
<li><p class="first">Robots capable of shooting from both long and short distances in 2020 would have found it difficult to use Hardware Zoom on their Limelights without the use of an active, adjustable Limelight mount. We have incorporated Hardware Panning to solve this problem.</p>
</li>
<li><p class="first">This gif shows Hardware Panning while using 3x Hardware Zoom. This should simplify mounting for teams who wish to use Hardware Zoom:</p>
</li>
<li><img alt="https://thumbs.gfycat.com/UntidyElaborateDartfrog-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/UntidyElaborateDartfrog-size_restricted.gif" />
</li>
<li><p class="first">Hardware Panning on the  X and Y axes at 3x Hardware Zoom</p>
</li>
<li><img alt="https://thumbs.gfycat.com/EdibleTimelyElver-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/EdibleTimelyElver-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id12">
<h4>Bugfixes<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Address driver issues that were breaking the color balance sliders</li>
<li>Revert all networking-related drivers to 2019 season variants to address a small number of network performance reports from teams</li>
</ul>
</div>
</div>
<div class="section" id="id13">
<h3>2020.1  (1/16/20)<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>2020.1 adds one of Limelight’s coolest features yet: 2x Hardware Zoom. This is not digital zoom, and it is now enabled for all Limelight versions.</p>
<div class="section" id="id14">
<h4>Features<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">2x Hardware Zoom</p>
<blockquote>
<div><ul>
<li><p class="first">Not Digital zoom</p>
</li>
<li><p class="first">Enable 2x Hardware zoom to achieve vastly improved tracking at long range, and stable tracking at full-court distances.</p>
</li>
<li><p class="first">This feature comes with absolutely no latency or framerate cost - tracking continues to execute at 90fps with no additional overhead.</p>
</li>
<li><p class="first">Zoom from the autonomous starting line (~127” away):</p>
</li>
<li><img alt="https://thumbs.gfycat.com/LawfulRapidArchaeocete-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/LawfulRapidArchaeocete-size_restricted.gif" />
</li>
<li><p class="first">Zoom from the front of the trench run (~210” away):</p>
</li>
<li><img alt="https://thumbs.gfycat.com/GrippingWaterloggedEmperorshrimp-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/GrippingWaterloggedEmperorshrimp-size_restricted.gif" />
</li>
<li><p class="first">Zoom from the front of the color wheel (~310” away):</p>
</li>
<li><img alt="https://thumbs.gfycat.com/UnlinedFarawayArcticduck-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/UnlinedFarawayArcticduck-size_restricted.gif" />
</li>
<li><p class="first">Zoom from the very back of the trench run (~420” away):</p>
</li>
<li><img alt="https://thumbs.gfycat.com/PartialColorlessGiraffe-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/PartialColorlessGiraffe-size_restricted.gif" />
</li>
<li><p class="first">Zoom from the sector line (nearly full-court):</p>
</li>
<li><img alt="https://thumbs.gfycat.com/GreatGiftedAkitainu-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/GreatGiftedAkitainu-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Manual Crosshairs</p>
<blockquote>
<div><ul>
<li><p class="first">Manually adjust single and dual crosshair locations with sliders in the web interface</p>
</li>
<li><img alt="https://thumbs.gfycat.com/ElaborateUnimportantCuscus-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/ElaborateUnimportantCuscus-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">New SolvePNP / 3D features (Still experimental)</p>
<blockquote>
<div><ul>
<li><p class="first">We have added the “Force Convex” option to use only the outermost points of a target - this is necessary in 2020 due to the thin tape used for the hexagonal target.</p>
</li>
<li><img alt="https://thumbs.gfycat.com/MemorableHastyFiddlercrab-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/MemorableHastyFiddlercrab-size_restricted.gif" />
</li>
<li><p class="first">The “bind target” option has been added. This feature binds “tx” and “ty” to the 3D target. This is required to guide robots to score using 3D targets.</p>
</li>
<li><img alt="https://thumbs.gfycat.com/DeadUnevenJackrabbit-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/DeadUnevenJackrabbit-size_restricted.gif" />
</li>
<li><p class="first">Finally, add the “Goal Z-Offset” option to automatically offset your desired target location in 3D space on the Z-axis.</p>
</li>
<li><p class="first">In Infinite Recharge, the “Goal Z-Offset” would be used to track the center of the small, circular goal behind the hexagonal goal.</p>
</li>
<li><img alt="https://thumbs.gfycat.com/AcidicHonoredElephant-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/AcidicHonoredElephant-size_restricted.gif" />
</li>
<li><p class="first">SolvePnP is still an experimental feature! We believe there are creative ways to play this game without SolvePnP, but we will continue to improve this feature.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Color sensing with “tc”</p>
<blockquote>
<div><ul class="simple">
<li>Read the new “tc” array in Network Tables to obtain Red, Green, and Blue values at the crosshair’s location. Adjust “Blue Balance” and “Red Balance” on the input tab to achieve perfect color sensing.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id15">
<h4>Bugfixes<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>USB Camera functionality broken in 2020.0 is now fixed in 2020.1</li>
<li>SolvePnP functionality broken in 2020.0 is now fixed in 2020.1</li>
<li>SolvePnP properly uses the model center as the axis visualization center</li>
</ul>
</div>
</div>
<div class="section" id="id16">
<h3>2019.7  (4/5/19)<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>2019.7 adds two new features.</p>
<div class="section" id="id17">
<h4>Features<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">160x120 30fps streaming</p>
<blockquote>
<div><ul>
<li><p class="first">Smoother, lower-bandwidth streaming for teams that use wide-angle USB cameras. Our 180-degree camera stream bandwidth dropped from ~3.7mbps to ~1.8 mbps.</p>
</li>
<li><p class="first">Change the stream resolution in the settings tab.</p>
</li>
<li><dl class="first docutils">
<dt>Changing the stream resolution on a Limelight with a wide-angle USB camera attached. No Picture-in-Picture, and normal stream rate.</dt>
<dd><ul class="first last">
<li><img alt="_images/20197_bandwidth.png" class="first" src="_images/20197_bandwidth.png" />
</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Smart Speckle Rejection</p>
<blockquote>
<div><ul>
<li><p class="first">Teams that have mounted their cameras in-line with the target this year have had to deal with unwanted LED reflections.</p>
</li>
<li><p class="first">The area slider does not always solve this problem, as teams want to track small vision targets at large distances.</p>
</li>
<li><p class="first">This new feature will automatically reject <em>relatively</em> small contours that have passed through all other filters.</p>
</li>
<li><p class="first">As a robot moves away from a vision target (decreasing its size), SSR will automatically adjust to only reject <em>relatively</em> small contours.</p>
</li>
<li><img alt="https://thumbs.gfycat.com/EachInsecureAustraliansilkyterrier-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/EachInsecureAustraliansilkyterrier-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="changes">
<h4>Changes<a class="headerlink" href="#changes" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Tooltips</p>
<blockquote>
<div><ul>
<li><p class="first">Tooltips are now avaiable on some Limelight controls</p>
</li>
<li><img alt="https://thumbs.gfycat.com/SeparateHonestEthiopianwolf-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/SeparateHonestEthiopianwolf-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="hotfix-3-14-19">
<h3>2019.6.1 Hotfix (3/14/19)<a class="headerlink" href="#hotfix-3-14-19" title="Permalink to this headline">¶</a></h3>
<p>2019.6.1 fixes Grip uploads.</p>
</div>
<div class="section" id="id18">
<h3>2019.6 (3/12/19)<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>2019.6 is all about reliability.</p>
<div class="section" id="id19">
<h4>Bugfixes<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">USB Cameras</p>
<blockquote>
<div><ul class="simple">
<li>Address issue that could cause some USB cameras to fail on boot.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">FMS</p>
<blockquote>
<div><ul class="simple">
<li>Make Limelight more (if not completely) resistant to FMS restarts and field / laptop networking changes.</li>
<li>Limelight will no longer hang after a sudden client networking change.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Raw Contour Sorting (BREAKING CHANGE)</p>
<blockquote>
<div><ul class="simple">
<li>Intersection filters no longer affect raw contour sorting.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Smartdashboard auto-posting</p>
<blockquote>
<div><p><a href="#id20"><span class="problematic" id="id21">*</span></a>LL auto-posts certain pieces of information to SmartDashboard (IP Address, Interface url, etc.). The names of these values now contain the hostname.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="features-changes">
<h4>Features &amp; Changes<a class="headerlink" href="#features-changes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Significantly increase precision and stability of the compute3d feature. Translation and rotation measurements are stable at larger distances.</li>
<li>Max Black Level Offset increased to 40 (from 25) for even darker images.</li>
<li><dl class="first docutils">
<dt>New “Closest” sort options in the “Output” tab while “Dual Crosshair” mode is enabled.</dt>
<dd><ul class="first last">
<li>Standard - Current “closest” sorting implementation with “Dual Crosshair” mode.</li>
<li>Standard V2 - Experimental, smart “closest” sorting implementation with “Dual Crosshair” mode.</li>
<li>Average of Crosshairs - “Closest” sort origin with “Dual Crosshair” mode is the average of the two crosshairs.</li>
<li>Crosshair A - “Closest” sort origin with “Dual Crosshair” mode is crosshair A.</li>
<li>Crosshair B - “Closest” sort origin with “Dual Crosshair” mode is crosshair B.</li>
</ul>
</dd>
</dl>
</li>
<li>New “LED Mode” pipeline options: “Left Half”, “Right Half”</li>
<li>Floating-point raw corner values while compute3D is enabled.</li>
<li>Hide image decorations while using magic wands</li>
<li>Larger stream in web interface</li>
</ul>
</div>
</div>
<div class="section" id="id22">
<h3>2019.5 (2/9/19)<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h3>
<p>With 2019.5 we are introducing the brand new compute3D camera localization feature. Only a handful of teams have ever attempted to add this feature to their vision systems, and now it is available to all Limelight 1 and Limelight 2 users.</p>
<p>This is not a silver bullet for this year’s game. We highly recommend thinking of creative ways to use the standard high-speed 90 fps tracking unless this feature is absolutely necessary.</p>
<img alt="https://thumbs.gfycat.com/LeftHalfBluewhale-size_restricted.gif" src="https://thumbs.gfycat.com/LeftHalfBluewhale-size_restricted.gif" />
<p>All example gifs were created with an LL2 mounted on the side of a kitbot. This is why you will see slight changes in translation during turns.</p>
<div class="section" id="id23">
<h4>Features<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">High-Precision Mode and PnP</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>In the following gif, a Limelight 2 was placed 37 inches behind and 14.5 inches to the right of the target.</dt>
<dd><ul class="first last">
<li><img alt="https://thumbs.gfycat.com/ThirstyFailingGreatdane-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/ThirstyFailingGreatdane-size_restricted.gif" />
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>The Limelight was later turned by hand. Notice how the distances remain mostly unchanged:</dt>
<dd><ul class="first last">
<li><img alt="https://thumbs.gfycat.com/DisloyalUnfinishedAntipodesgreenparakeet-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/DisloyalUnfinishedAntipodesgreenparakeet-size_restricted.gif" />
</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">With 2019.4, we introduced corner sending. This allowed advanced teams to write their own algorithms using OpenCV’s solvePNP(). With 2019.5, this is all done on-board.</p>
</li>
<li><p class="first">Upload a plain-text csv file with a model of your target. We have pre-built models of 2019 targets hosted on our website. All models must have a centered origin, and use counter-clockwise point ordering with inch scaling.</p>
</li>
<li><p class="first">Enable the new high-res 960x720 mode, and then enable “Solve 3D” to aquire the position and rotation of your Limelight relative to your target.</p>
</li>
<li><p class="first">Corner numbers are now displayed on the image for easier model creation and threshold tuning.</p>
</li>
<li><p class="first">Read all 6 dimensions of your camera’s transform (x,y,z,pitch,yaw,roll) by reading the “camtran” networktable number array.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Black Level</p>
<blockquote>
<div><ul>
<li><p class="first">With the new black level slider, thresholding is even easier. Increase the black level offset to further darken your images.</p>
</li>
<li><img alt="https://thumbs.gfycat.com/FoolishUnimportantLacewing-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/FoolishUnimportantLacewing-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="breaking-changes">
<h4>Breaking Changes<a class="headerlink" href="#breaking-changes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>The reported vertical FOV for LL2 has been fixed to match the listed value of 49.7 degrees. This will change your “ty” values</li>
</ul>
</div>
<div class="section" id="bug-fixes">
<h4>Bug Fixes<a class="headerlink" href="#bug-fixes" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix stream-only crash that could occur when fisheye USB cameras were attached.</li>
<li>Fix rare hang caused by networking-related driver.</li>
<li>Corner approximation is now always active.</li>
</ul>
</div>
</div>
<div class="section" id="id24">
<h3>2019.4 (1/26/19)<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>We believe all critical bug reports are covered with this release.</p>
<div class="section" id="id25">
<h4>Features<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Corners</p>
<blockquote>
<div><ul class="simple">
<li>Send the corners of your target as two arrays (tcornx, tcorny) <a href="#id26"><span class="problematic" id="id27">*</span></a>NOW tcornxy by enabling “send corners” in the “Output” tab. This will further enable teams that are interested in advanced pipelines with methods like solvePNP().</li>
<li>Adjust corner approximation with the “corner approximation” slider in the “Output” tab.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id28">
<h4>Bug Fixes<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix hang + rare crash that would occur when two targets had exactly the same area, x coordinate, or y coordinate.</li>
<li>Fix area calculation in dual- and tri-target modes.</li>
<li>Optimize contour sorting for better performance.</li>
</ul>
</div>
</div>
<div class="section" id="id29">
<h3>2019.3 (1/19/19)<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>2019.3 addresses a number of bugs and feature requests.</p>
<div class="section" id="id30">
<h4>Features<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Stream Rate (bandwidth reduction)</p>
<blockquote>
<div><ul class="simple">
<li>Set the stream rate to “low” in the settings page for a lower-bandwidth 15fps video stream.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Raw Contours disabled in NetworkTables (bandwidth reduction)</p>
<blockquote>
<div><ul class="simple">
<li>Raw contours are now disabled by default. This will further reduce Limelight’s overall bandwidth.</li>
<li>There are now ~180 fewer networktables entries submitted per second by default.</li>
<li>See the new “Raw Contours” pipeline option in the “Output” tab to re-enable raw contours.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Active Pipeline Index</p>
<blockquote>
<div><ul class="simple">
<li>Read the networktable key “getpipe” to get the true active pipeline index of the camera. This is updated at 90hz.</li>
<li>The active pipeline index is now written to the videostream underneath the FPS display.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Left and Right Intersection Filters</p>
<blockquote>
<div><ul class="simple">
<li>Teams may now choose between “left” and “right” dual-contour intersection filters. The “above” and “below” intersection filters were added in 2019.2.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id31">
<h4>Bug Fixes<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix LabView Dashboard streaming bug introduced in 2019.2</li>
<li>The webpage no longer requests icon fonts from a the internet. All fonts are stored locally. This should speed up interface loading.</li>
<li>Reduce “driver mode” exposure.</li>
<li>Fix “Distance Transform” GRIP implementation</li>
<li>Fix 20-second communication delays caused by changing the hostname.</li>
</ul>
</div>
</div>
<div class="section" id="id32">
<h3>2019.2 (1/7/19)<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>2019.2 adds new features to better equip teams for the 2019 season.</p>
<ul>
<li><p class="first">Intersection Filter</p>
<blockquote>
<div><ul>
<li><img alt="https://thumbs.gfycat.com/ThunderousWholeDinosaur-size_restricted.gif" class="first align-center" src="https://thumbs.gfycat.com/ThunderousWholeDinosaur-size_restricted.gif" />
</li>
<li><p class="first">The all-new intersection filter will allow teams to better distinguish between different groups of contours. The filter extends contours to infinity, and checks where they would intersect.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Direction Filter</p>
<blockquote>
<div><ul>
<li><img alt="https://thumbs.gfycat.com/HalfUnselfishHarvestmen-size_restricted.gif" class="first align-center" src="https://thumbs.gfycat.com/HalfUnselfishHarvestmen-size_restricted.gif" />
</li>
<li><p class="first">The new direction filter will allow teams to better distinguish between contours of different orientations.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Additional Changes and Fixes</p>
<blockquote>
<div><ul class="simple">
<li>IP Address is auto-posted to SmartDashboard/Shuffleboard for easier event troubleshooting. We have had almost no reports of this being an issue, but this serves as another contingency feature.</li>
<li>Pipeline name is auto-posted to SmartDashboard/Shuffleboard</li>
<li>Access the width and height of the rough bounding box in pixels with new networktables keys.</li>
<li>Access the longest side and shortest side of the perfect bounding box in pixels with new networktables keys.</li>
<li>“Sort Mode” now applies to dual-contours</li>
<li>“Sort Mode” is now fixed</li>
<li>5802 stream is less taxing on the camera</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id33">
<h3>2019.1 (12/18/18)<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>2019.1 fixes all major bugs reported during the beta</p>
<ul class="simple">
<li>Performance is back to a steady 90fps. A driver issue was the root cause of our performance problems during beta</li>
<li>IP and hostname settings actually apply and “stick”</li>
<li>Magic Wands have been re-ordered to match those of Limelight 2018 software</li>
<li>We now support Grip inputs like masks through the web interface</li>
<li>NetworkTables freeze fixed</li>
</ul>
</div>
<div class="section" id="id34">
<h3>2019.0 (12/10/18)<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<p>With 2019, we are introducing GRIP support, a brand-new interface, and a cleaner flashing procedure.</p>
<ul>
<li><p class="first">Grip Support</p>
<blockquote>
<div><ul class="simple">
<li>Build pipelines with GRIP For Limelight, and export “LL Script” files to upload to your camera.</li>
<li>Masks and NetworkTables support will be added in a future update</li>
<li>Expose a bare video stream at <a class="reference external" href="http:/">http:/</a>/&lt;limelighturl&gt;:5802 for testing in grip</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">All-new web interface</p>
<blockquote>
<div><ul class="simple">
<li>Smaller controls</li>
<li>More tooltips</li>
<li>Add the ability to turn off the LEDs from the interface</li>
<li>Move display combobox underneath stream for easier display switching</li>
<li>Faster communication to Limelight. New web tech allowed us to simplify other parts of our code.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Flashing</p>
<blockquote>
<div><ul class="simple">
<li>We have migrated to “Balena Etcher”</li>
<li>Etcher is twice as fast and works on all platforms</li>
<li>Flash popups are fixed with the migration.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Other</p>
<blockquote>
<div><ul class="simple">
<li>The LED Mode has been modified to allow for pipeline-specific LED Modes. LED MODE 0 is now “pipeline mode”, while mode 1 is “force off”</li>
<li>Faster boot times in automatic IP assignment mode.</li>
<li>Optimizations and minor bug fixes</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id35">
<h3>2018.5 (3/28/18)<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<p>2018.5 fixes a critical issue that would prevent users from tuning pipelines on snapshots.</p>
</div>
<div class="section" id="id36">
<h3>2018.4 (3/19/18)<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>2018.4 adds new contour sorting options. These are fairly important for cube tracking this year, as teams don’t necessarily want to track the largest cube in view. In many cases, teams want to track the cube that is closest to their intakes. Many users have had to use the raw contours feature to implement their own sorting, so we want to make this as easy as possible.</p>
<ul>
<li><p class="first">Contour Sort Mode</p>
<blockquote>
<div><ul>
<li><p class="first">Select between “largest”, “smallest”, “highest”, “lowest”, “leftmost”, “rightmost”, and “closest” sort options.</p>
</li>
<li><p class="first">We feel that many teams will make use of the “closest” option for cube tracking.</p>
</li>
<li><img alt="https://thumbs.gfycat.com/PlaintiveSizzlingEskimodog-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/PlaintiveSizzlingEskimodog-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="id37">
<h3>2018.3 (2/28/18)<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>2018.3 fixes a major networktables reconnection bug which would cause NetworkTables settings changes to not propagate to Limelight. Thanks to Peter Johnson and the WPILib team for pinpointing and fixing the underlying NT bug. This was (as far as we know) the last high-priority bug facing Limelight.</p>
<p>Settings changes such as ledMode, pipeline, and camMode should always apply to Limelight. You should no longer need workarounds to change Limelight settings while debugging, after restarting robot code, and after rebooting the roborio.</p>
<div class="section" id="id38">
<h4>Changes<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Fix major NT syncing issue which broke settings changes (ledMode, pipeline, and camMode) during LabView debugging, and after a reset/reboot of the roborio.</p>
</li>
<li><p class="first">Eye-dropper wand:</p>
<blockquote>
<div><ul class="simple">
<li>The eye dropper wand uses the same 10 unit window for Hue, but now uses a 30 unit window for saturation and value. This means that thresholding is more often a one-click operation, rather than a multi-step process.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Snapshots</p>
<blockquote>
<div><ul>
<li><p class="first">Setting the snapshot value to “1” will only take a single snapshot and reset the value to 0. Snapshotting is throttled to 2 snapshots per second.</p>
</li>
<li><p class="first">Snapshot limit increased to 100 images.</p>
</li>
<li><p class="first">Snapshot selector area is now scrollable to support 100 images.</p>
</li>
<li><img alt="https://thumbs.gfycat.com/ComplexConstantGalapagosalbatross-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/ComplexConstantGalapagosalbatross-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="id39">
<h3>2018.2 (2/10/18)<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<p>2018.2 fixes all known streaming bugs with various FRC dashboards. It also makes Limelight easier to tune and more versatile during events.</p>
<div class="section" id="id40">
<h4>Features<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">Thresholding wands</p>
<blockquote>
<div><ul>
<li><p class="first">Setup HSV threshold parameters in a matter of clicks</p>
</li>
<li><p class="first">The “Set” wand centers HSV parameters around the selected pixel</p>
</li>
<li><p class="first">The “Add” wand adjusts HSV parameters to include the selected pixel</p>
</li>
<li><img alt="https://thumbs.gfycat.com/FarHandyCanvasback-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/FarHandyCanvasback-size_restricted.gif" />
</li>
<li><p class="first">The “Subtract” wand adjusts HSV paramters to ignore the selected pixel</p>
</li>
<li><img alt="https://thumbs.gfycat.com/HoarseEnragedIslandwhistler-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/HoarseEnragedIslandwhistler-size_restricted.gif" />
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Snapshots</p>
<blockquote>
<div><ul>
<li><img alt="https://thumbs.gfycat.com/WindyDefiantCrayfish-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/WindyDefiantCrayfish-size_restricted.gif" />
</li>
<li><p class="first">Snapshots allow users to save what Limelight is seeing during matches or event calibration, and tune pipelines while away from the field.</p>
</li>
<li><p class="first">Save a snapshot with the web interface, or by posting a “1” to the “snapshot” NetworkTables key</p>
</li>
<li><p class="first">To view snapshots, change the “Image Source” combo box on the input tab. This will allow you to test your pipelines on snapshots rather than Limelight’s camera feed</p>
</li>
<li><p class="first">Limelight will store up to 32 snapshots. It will automatically delete old snapshots if you exceed this limit.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">New Streaming options</p>
<blockquote>
<div><ul class="simple">
<li>We’ve introduced the “stream” NetworkTables key to control Limelight’s streaming mode. We’ve received requests for PiP (Picture-in-Picture) modes to better accomodate certain dashboards.</li>
<li>0 - Standard - Side-by-side streams if a webcam is attached to Limelight</li>
<li>1 - PiP Main - The secondary camera stream is placed in the lower-right corner of the primary camera stream.</li>
<li>2 - PiP Secondary - The primary camera stream is placed in the lower-right corner of the secondary camera stream.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Increase streaming framerate to 22fps</p>
<blockquote>
<div><ul class="simple">
<li>Look out for faster streams in an upcoming update</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Erosion and Dilation</p>
<blockquote>
<div><ul class="simple">
<li>Enable up to one iteration of both erosion and dilation.</li>
<li>Erosion will slightly erode the result of an HSV threshold. This is useful if many objects are passing through a tuned HSV threshold.</li>
<li>Dilation will slightly inflate the result of an HSV threshold. Use this to patch holes in thresholding results.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Restart Button</p>
<blockquote>
<div><ul class="simple">
<li>Restart Limelight’s vision tracking from the web interface. This is only useful for teams that experience intermittent issues while debugging LabView code.</li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="optimizations">
<h4>Optimizations<a class="headerlink" href="#optimizations" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Drop steady-state pipeline execution time to 3.5-4ms.</li>
</ul>
</div>
<div class="section" id="id41">
<h4>Bug Fixes<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix Shuffleboard streaming issues</li>
<li>Fix LabView dashboard streaming issues</li>
</ul>
</div>
</div>
<div class="section" id="id42">
<h3>2018.1 (1/8/18)<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Red-Balance slider</li>
<li>Blue-Balance slider</li>
<li>Better default color balance settings</li>
<li>Increased max exposure setting</li>
</ul>
</div>
<div class="section" id="id43">
<h3>2018.0 (1/3/18)<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h3>
<p>On top of a ton of new case studies, more detailed documentation, and a full example program for an autonomous STEAMWORKS shooter, the software has received a major upgrade.</p>
<div class="section" id="id44">
<h4>Features<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p class="first">New Vision Pipeline interface:</p>
<blockquote>
<div><ul>
<li><img alt="https://thumbs.gfycat.com/UnfitLankyHadrosaurus-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/UnfitLankyHadrosaurus-size_restricted.gif" />
</li>
<li><p class="first">Add up to 10 unique vision pipelines, each with custom crosshairs, thresholding options, exposure, filtering options, etc.</p>
</li>
<li><p class="first">Name each vision pipeline.</p>
</li>
<li><p class="first">Mark any pipeline as the “default” pipeline.</p>
</li>
<li><p class="first">Instantly switch between pipelines during a match with the new “pipeline” NetworkTables value. This is useful for games that have multiple vision targets (eg. the gear peg and boiler from 2017). This is also useful for teams that need to use slightly different crosshair options per robot, field, alliance, etc.</p>
</li>
<li><p class="first">Download vision pipelines from Limelight to backup or share with other teams.</p>
</li>
<li><p class="first">Upload vision pipelines to any “slot” to use downloaded pipelines.</p>
</li>
</ul>
</div></blockquote>
</li>
<li><dl class="first docutils">
<dt>Target “Grouping” option:</dt>
<dd><ul class="first last">
<li><p class="first">Instantly prefer targets that consist of two shapes with the “dual” grouping mode”. “Single” and “Tri” options are also available</p>
</li>
<li><img alt="https://thumbs.gfycat.com/ScalyDeficientBrahmanbull-size_restricted.gif" class="first" src="https://thumbs.gfycat.com/ScalyDeficientBrahmanbull-size_restricted.gif" />
</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>New Crosshair Calibration interface:</dt>
<dd><ul class="first last simple">
<li>“Single” and “Dual” crosshair modes.</li>
<li>“Single” mode is what Limelight utilized prior to this update. Teams align their robots manually, and “calibrate” to re-zero targeting values about the crosshair.</li>
<li>“Dual” mode is an advanced feature for robots that need a dynamic crosshair that automatically adjusts as a target’s area / distance to target changes. We’ve used this feature on some of our shooting robots, as some of them shot with a slight curve. This feature will also be useful for robots with uncentered andor misaligned Limelight mounts.</li>
<li>Separate X and Y calibration.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Add Valid Target “tv” key to Network Tables.</p>
</li>
<li><p class="first">Add Targeting Latency “tl” key to Network Tables. “tl” measures the vision pipeline execution time. Add at least 11 ms for capture time.</p>
</li>
<li><p class="first">Draw additional rectangle to help explain aspect ratio calculation.</p>
</li>
<li><p class="first">Remove throttling feature, and lock Limelight to 90fps.</p>
</li>
<li><p class="first">Disable focusing on most web interface buttons. Fixes workflow problem reported by teams who would calibrate their crosshairs, then press “enter” to enable their robots.</p>
</li>
<li><dl class="first docutils">
<dt>Post three “raw” contours and both crosshairs to Network Tables.</dt>
<dd><ul class="first last simple">
<li>Access a raw contour with tx0, tx1, ta0, ta1, etc.</li>
<li>Access both raw crosshairs with cx0, cy0, cx1, cy1.</li>
<li>All x/y values are in normalized screen space (-1.0 to 1.0)</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Add “suffix” option to web interface. Allows users to add a suffix to their Limelights’ hostnames and NetworkTables (e.g. limelight-boiler). This feature should only be utilized if teams intend to use multiple Limelights on a single robot.</p>
</li>
<li><p class="first">Display image version on web interface</p>
</li>
</ul>
</div>
<div class="section" id="id45">
<h4>Optimizations<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Decrease networking-related latency to ~0.2 ms from ~10ms (Thanks Thad House)</li>
<li>Move stream encoding and jpg compression to third core, eliminating 10ms hitch (25 - 30ms hitch with two cameras) seen every six frames.</li>
<li>Drop steady-state pipeline execution time to 5ms with SIMD optimizations.</li>
</ul>
<img alt="_images/20180_latency.png" src="_images/20180_latency.png" />
<ul class="simple">
<li>New Latency testing shows 22 ms total latency from photons to targeting information.</li>
<li>Upgrade Network Tables to v4 (Thanks Thad House)</li>
<li>Optimize contour filtering step. Latency no longer spikes when many contours exist.</li>
<li>Much improved hysterisis tuning.</li>
<li>Significantly improve responsiveness of webinterface&lt;-&gt;limelight actions.</li>
</ul>
</div>
<div class="section" id="id46">
<h4>Bugfixes<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Fix minor area value inaccuracy which prevented value from reaching 100% (maxed ~99%).</li>
<li>Fix half-pixel offset in all targeting calculations</li>
<li>Fix camera stream info not populating for NT servers started after Limelight’s boot sequence. Regularly refresh camera stream info.</li>
<li>Fix bug which caused aspect ratio to “flip” occasionally.</li>
<li>Force standard stream output (rather than thresholded output) in driver mode.</li>
<li>Fix bug which prevented LEDs from blinking after resetting Networking information</li>
</ul>
</div>
</div>
<div class="section" id="id47">
<h3>2017.7 (11/21/17)<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Improved contour sorting. Was favoring small contours over larger contours.</li>
<li>New Coordinate system: Center is (0,0). ty increases as the target moves “up” the y-axis, and tx increases as the target moves “right” along the x-axis.</li>
<li>More accurate angle calculations (Pinhole camera model).</li>
<li>Display targeting info (tx, ty, ta, and ts) on webpage</li>
<li>Default targeting values are zeros. This means zeros are returned if no target is in view.</li>
<li>New side-by-side webpage layout. Still collapses to single column on small devices.</li>
<li>Continuous slider updates don’t hurt config panel performance.</li>
<li>Aspect ratio slider scaled such that 1:1 is centered.</li>
</ul>
</div>
<div class="section" id="id48">
<h3>2017.6 (11/13/17)<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>New Imaging tool. Tested on Win7, Win8 and Win10.</li>
<li>Post camera stream to cameraserver streams. Works with smart dashboard camera streams, but shuffleboard has known bugs here</li>
<li>Quartic scaling on area sliders, quadratic scaling on aspect ratio sliders. This makes tuning much easier</li>
<li>Organize controls into “input”, “threshold”, “filter”, and “output” tabs</li>
<li>Continuous updates while dragging sliders</li>
<li>Area sent to NT as a percentage (0-100)</li>
<li>Image size down to 700MB from 2.1GB</li>
</ul>
</div>
<div class="section" id="id49">
<h3>2017.5 (11/9/17)<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Image size down to 2.1GB from 3.9GB</li>
<li>Add driver mode and led mode apis</li>
<li>Set ledMode to 0, 1, or 2 in the limelight table.</li>
<li>Set camMode to 0 or 1 in the limelight table.</li>
<li>Add ability to toggle between threshold image and raw image via web interface (will clean up in later release)</li>
<li>Post camera stream to network tables under CameraPublishing/limelight/streams (will need a hotfix)</li>
<li>Add skew to targeting information (“ts” in limelight table)</li>
<li>Add base “CommInterface” in anticipation of more protocols</li>
</ul>
</div>
<div class="section" id="id50">
<h3>2017.4 (10/30/17)<a class="headerlink" href="#id50" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Lots of boot and shutdown bullet-proofing</li>
</ul>
</div>
<div class="section" id="id51">
<h3>2017.3 (10/25/17)<a class="headerlink" href="#id51" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Hue range is 0-179 from 0-255</li>
<li>Decrease max log size, clear logs, clear apt cache</li>
</ul>
</div>
<div class="section" id="id52">
<h3>2017.2 (10/23/17)<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Manual ISO sensitivity</li>
<li>Minimum exposure increased to 2</li>
</ul>
</div>
<div class="section" id="id53">
<h3>2017.1 (10/21/17)<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Optimizations</li>
<li>“Convexity” changed to “Fullness”</li>
<li>Exposure range set to 0-128 ms from 0-255 ms</li>
<li>Support two cameras</li>
<li>Fully support single-point calibration</li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Limelight
      
        <span class="commit">
          Revision <code>98f92698</code>.
        </span>
      

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//docs.limelightvision.io/_/downloads/en/latest/pdf/">pdf</a></dd>
        
          <dd><a href="//docs.limelightvision.io/_/downloads/en/latest/htmlzip/">html</a></dd>
        
          <dd><a href="//docs.limelightvision.io/_/downloads/en/latest/epub/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/limelight/?fromdocs=limelight">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/limelight/?fromdocs=limelight">Builds</a>
          </dd>
      </dl>
      <hr/>
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
   

</body>
</html>